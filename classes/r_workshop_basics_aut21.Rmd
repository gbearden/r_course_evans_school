---
title: "Part 1 - R Basics"
author: "Graham Bearden"
date: "October 8, 2020"
output: 
  ioslides_presentation:
    css: custom.css
    widescreen: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
options(scipen=999)

setwd('/Users/grahamb/Analysis/r_course_evans_school')

opts_chunk$set(warning=FALSE, message=FALSE)

covid <- read_csv('https://rb.gy/lzlylj')
crime <- read_csv('https://rb.gy/5zuayh') 
```

## First things first

- Set up your machine to run R
  - Install R ([on a Mac](https://cloud.r-project.org/bin/macosx/base/R-4.1.1.pkg) and [on a PC](https://cran.r-project.org/bin/windows/base/R-4.1.1-win.exe))
  - Install RStudio ([on a Mac](https://download1.rstudio.org/desktop/macos/RStudio-1.4.1717.dmg) and [on a PC](https://download1.rstudio.org/desktop/windows/RStudio-1.4.1717.exe))

## Some things you should know {.smaller}

- Typical uses for R
  - Data analysis
  - Data visualization
  - Reshaping data
  - Automation
- Mental models and programming
  - Excel/SPSS/Stata --> computational programming tools like R
- What all R programmers do
  - Google for answers
  - Borrow code
  - Ask friends and pros for help
- Useful references (see Reference Materials in the [syllabus](https://github.com/gbearden/r_course_evans_school) for more)
  - help()
  - ??
  - [R Bloggers](https://www.r-bloggers.com/)
  - [stackoverflow](https://stackoverflow.com/questions/tagged/r)

# Quick Tour of R Studio

## Quick Tour of R Studio

- Open and save (locally) an R Notebook  
- Run code from the notebook and the console  
- Make sure you can install packages
  - 2 ways to install packages
    - Command line/Console
    - R Studio GUI

## Quick Tour of R Studio

- Open and save (locally) an R Notebook  
- Make sure you can install packages
  - 2 ways to install packages
    - **Command line/Console**
    - R Studio GUI
    
```r
install.packages('devtools')
```

## Quick Tour of R Studio

- Open and save (locally) an R Notebook  
- Make sure you can install packages
  - 2 ways to install packages
    - Command line/Console
    - **R Studio GUI**

```{r fig.width=7, fig.height=3.5,echo=FALSE}
library(png)
library(grid)
img <- readPNG("figures/r_studio_install_packages.png")
grid.raster(img)
```

#  Libraries, functions, data

##  <span style='color:#6DA34D'>Libraries</span>, functions, data

- Libraries (or packages) are collections of functions (and datasets)
- Over 10,000 libraries on CRAN

```r
install.packages('tidyverse')
install.packages('ggthemes')
library(tidyverse)
```

## Libraries, <span style='color:#6DA34D'>functions</span>, data

- Functions perform operations in R
```r
foo <- c(1,2,4)
min(foo)
mean(foo)
max(foo)
sd(foo)
```

## Libraries, <span style='color:#6DA34D'>functions</span>, data

- Functions perform operations in R
```{r, echo = TRUE, collapse=TRUE}
foo <- c(1,2,4)
min(foo)
mean(foo)
max(foo)
sd(foo)
```

## Libraries, <span style='color:#6DA34D'>functions</span>, data

- Function arguments
  - Let's look at arguments in the `lm` and `min` functions  
  - Arguments are inputs
  - Arguments are comma separated

```r
help(lm)
help(min)

cat_function <- function(love = TRUE){
    if(love == TRUE){
        print('I love cats!')
    }
    else {
        print('I am not a cool person.')
    }
}
```

## Libraries, <span style='color:#6DA34D'>functions</span>, data

- Function arguments
  - Let's look at arguments in the `lm` and `min` functions  
  - Arguments are inputs
  - Arguments are comma separated

```r
foo <- c(1,2,NA, 4)
min(foo)
mean(foo)
max(foo)
sd(foo)
```

## Libraries, <span style='color:#6DA34D'>functions</span>, data

- Function arguments
  - Let's look at arguments in the `lm` and `min` functions    
  - Arguments are inputs
  - Arguments are comma separated

```{r, echo = TRUE, collapse=TRUE}
foo <- c(1,2,NA, 4)
min(foo)
mean(foo)
max(foo)
sd(foo)
```

## Libraries, <span style='color:#6DA34D'>functions</span>, data

- Function arguments
  - Let's look at arguments in the `glm` and `min` functions    
  - Arguments are inputs
  - Arguments are comma separated

```{r, echo = TRUE, collapse=TRUE}
foo <- c(1,2,NA, 4)
min(foo, na.rm= TRUE)
mean(foo, na.rm= TRUE)
max(foo, na.rm= TRUE)
sd(foo, na.rm= TRUE)
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - Vectors, tibbles, data frames, matrices
  - Integers, numbers, characters, factors
- Confirm data type
```r
class(c('Washington', 'Oregon', 'Idaho'))
is.character(c('Washington', 'Oregon', 'Idaho'))
is.factor(c('Washington', 'Oregon', 'Idaho'))
```
- Coerce data type
```r
as.factor(c('Washington', 'Oregon', 'Idaho'))
class(as.factor(c('Washington', 'Oregon', 'Idaho')))
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - Vectors, tibbles, data frames, matrices  
  - Integers, numbers, characters, factors
- Confirm data type
```{r, echo = TRUE, collapse=TRUE}
class(c('Washington', 'Oregon', 'Idaho'))
is.character(c('Washington', 'Oregon', 'Idaho'))
is.factor(c('Washington', 'Oregon', 'Idaho'))
```
- Coerce data type
```r
as.factor(c('Washington', 'Oregon', 'Idaho'))
class(as.factor(c('Washington', 'Oregon', 'Idaho')))
```

## Libraries, functions, <span style='color:#6DA34D'>data</span> {.smaller}

- Oh my, so many types of data!
  - Vectors, tibbles, data frames, matrices  
  - Integers, numbers, characters, factors
- Confirm data type
```{r, echo = TRUE, collapse=TRUE}
class(c('Washington', 'Oregon', 'Idaho'))
is.character(c('Washington', 'Oregon', 'Idaho'))
is.factor(c('Washington', 'Oregon', 'Idaho'))
```
- Coerce data type
```{r, echo = TRUE, collapse=TRUE}
as.factor(c('Washington', 'Oregon', 'Idaho'))
class(as.factor(c('Washington', 'Oregon', 'Idaho')))
```

## Libraries, functions, <span style='color:#6DA34D'>data</span> 

- Oh my, so many types of data!
  -  **Vectors**, tibbles, data frames, matrices  
- Vectors contain 1 or more values in a string  
- Call a specific element by its location in a vector  
```{r, echo = TRUE, collapse=TRUE}
c('Washington', 'Oregon', 'Idaho')
1:10
rep(1:2, times = 2)
seq(from = 0, to = 100, by = 10)
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - **Vectors**, tibbles, data frames, matrices  
- Vectors contain 1 or more values in a string  
- Call a specific element by its location in a vector  
```r
c('Washington', 'Oregon', 'Idaho')[2]
seq(from = 0, to = 100, by = 10)[6]
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - **Vectors**, tibbles, data frames, matrices  
- Vectors contain 1 or more values in a string  
- Call a specific element by its location in a vector  
```{r, echo = TRUE, collapse=TRUE}
c('Washington', 'Oregon', 'Idaho')[2]
seq(from = 0, to = 100, by = 10)[6]
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - Vectors, **tibbles**, data frames, matrices  
- Tibbles look a little like spreadsheets
```{r, echo = TRUE, collapse=TRUE}
tibble(x = c(1:3), y = c(4:6), z = c('Washington', 'Oregon', 'Idaho'))
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Call a specific variable by name or location in the tibble
  - Variables are vectors  
  - Use the `$` between the tibble name and the variable name
  - Also able to call the column (or row) by index number

```{r, echo = TRUE, collapse=TRUE}
head(cars$speed, 7)
```

```{r, echo = TRUE, collapse=TRUE}
head(cars[,1], 7)
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - Vectors, tibbles, **data frames**, matrices
- Data frames are like tibbles minus metadata (and truncated print)
```{r, echo = TRUE, collapse=TRUE}
data.frame(x = c(1:3), y = c(4:6), z = c('Washington', 'Oregon', 'Idaho'))
```

## Libraries, functions, <span style='color:#6DA34D'>data</span>

- Oh my, so many types of data!
  - Vectors, tibbles, data frames, **matrices**
- Matrices and tibbles have similar shapes
- Traditionally matrices contained data of a single type
- When it comes down to using a matrix or tibbles in our class, tibbles are the way to go

```{r, echo = TRUE, collapse=TRUE}
matrix(data = 1:6, nrow = 3, ncol = 2)
```

# Let's apply what we learned to real data

## Let's apply what we learned to real data

You are an analyst at a large global health organization. Organizational leadership needs to report pubically on the Covid-19 data that you've collected. Over the next month, you will be asked to prepare findings that you observe in the data.  

**Exercise 1 - 5 minutes**  
- What type of data object is `covid`?  
- What are the `min()` and `mean()` for `est_infections_p100k`?  
- What is the range for `date`?  

## Let's apply what we learned to real data

**Exercise 1 - 5 minutes**  
- What type of data object is `covid`?  
- What are the `min()` and `mean()` for `est_infections_p100k`?  
- What is the range for `date`?  

To answer the questions, import the Covid-19 dataset.  
```r
covid <- read_csv('https://rb.gy/lzlylj')
```

## Let's apply what we learned to real data

**Exercise 1 - 5 minutes**  
- What type of data object is `covid`?  
- What are the `min()` and `mean()` for `est_infections_p100k`?  
- What is the range for `date`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% class()
```

## Let's apply what we learned to real data

**Exercise 1 - 5 minutes**  
- What type of data object is `covid`?  
- What are the `min()` and `mean()` for `est_infections_p100k`?  
- What is the range for `date`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% class()
covid %>% pull(est_infections_p100k) %>% min(na.rm = TRUE)
covid %>% pull(est_infections_p100k) %>% mean(na.rm = TRUE)
```

## Let's apply what we learned to real data

**Exercise 1 - 5 minutes**  
- What type of data object is `covid`?  
- What are the `min()` and `mean()` for `est_infections_p100k`?  
- What is the range for `date`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% class()
covid %>% pull(est_infections_p100k) %>% min(na.rm = TRUE)
covid %>% pull(est_infections_p100k) %>% mean(na.rm = TRUE)
covid %>% pull(date) %>% min(na.rm = TRUE)
covid %>% pull(date) %>% max(na.rm = TRUE)
```

# Base R functions to explore tibbles

## Base R functions to explore tibbles {.smaller}

- Get in the habit of running these functions when you open a new dataset
  - `head()` shows you the top subset of a data in a tibble
    - `head()` argument defaults to 6  
    - `tail()` shows the bottom subset of data in a tibble  
  - `summary()` shows summary statistics on all variabes in a dataset
    - Reported summary statistics depend on the variable type
  - `ls()` shows all variables in a tibble
    - You can also use `ls()` without calling an object between the parentheses to see all objects in your workspace
  - `str()` tells the variable type and selected variable values in a tibble for all variables
  - `dim()` tells you the dimensions of your dataset
    - `nrow()` reports the number of rows only 
    - `ncol()` reports the number of columns only

## Base R functions to explore tibbles

**Exercise 2 - 5 minutes**  
- How many observations (or rows) are in `covid`?  
- What is the `median()` value for `mobility_composite`?  
- How many variables are in `covid`?  

<i>Hint: There are multiple ways to answers these questions with the functions you know</i>

## Base R functions to explore tibbles 

**Exercise 2 - 5 minutes**  
- How many observations (or rows) are in `covid`?  
- What is the `median()` value for `mobility_composite`?  
- How many variables are in `covid`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% dim()
```

## Base R functions to explore tibbles

**Exercise 2 - 5 minutes**  
- How many observations (or rows) are in `covid`?  
- What is the `median()` value for `mobility_composite`?  
- How many variables are in `covid`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% dim()
covid %>% pull(mobility_composite) %>% median(na.rm = TRUE)
```

## Base R functions to explore tibbles

**Exercise 2 - 5 minutes**  
- How many observations (or rows) are in `covid`?  
- What is the `median()` value for `mobility_composite`?  
- How many variables are in `covid`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% dim()
covid %>% pull(mobility_composite) %>% median(na.rm = TRUE)
covid %>% ncol()
```

## Base R functions to explore tibbles

**Exercise 2 - 5 minutes**  
- How many observations (or rows) are in `covid`?  
- What is the `median()` value for `mobility_composite`?  
- How many variables are in `covid`?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% dim()
covid %>% pull(mobility_composite) %>% median(na.rm = TRUE)
covid %>% ncol()
```

Other methods to answer questions
```r
covid %>% nrow()
covid %>% summary()
covid %>% ls()
```

## Base R functions to explore vectors

- `table()` shows you the distribution of values in a vector  
- `length()` tells you in the number of elements in a vector  
- `unique()` shows you the unique values in a vector  
- `sort()` orders values in a vector  
- `summary()` shows you descriptive statistics for a vector  
  - `summary()` can run on a vector or tibble  
  
You can chain together multiple functions
```r
covid %>% pull(location) %>% unique() %>% length()
```

## Base R functions to explore vectors

**Exercise 3 - 5 minutes**  
- How many 'projected' values are there in `mobility_data_type`?  
- Which is the third to last value for `location` when values are listed alphabetically?  
- Is 'projected' a value from the `total_tests_data_type` variable?  

## Base R functions to explore vectors

**Exercise 3 - 5 minutes**  
- How many 'projected' values are there in `mobility_data_type`?  
- Which is the third to last value for `location` when values are listed alphabetically?  
- Is 'projected' a value from the `total_tests_data_type` variable?  

```{r, echo = TRUE, collapse=TRUE}
covid %>% pull(mobility_data_type) %>% table()
covid %>% pull(location) %>% table() %>% tail()
covid %>% pull(total_tests_data_type) %>% unique() 
```

## Troubleshooting your R code {.smaller}

Make sure...

- You loaded your libraries
- Arguments in your functions are comma-separated
- Your functions have a closing paren
- You have an end quotation mark where relevant
- The variable type is correct to perform the function you call
  - For example you probably don't want to run `min()` on a character string

- Your definition operator looks like this
```r 
<-
```
- You pipe operator looks like this 
```r 
%>%
```

## Troubleshooting your R code

**Exercise 4 - 5 minutes**  

This code contains 6 mistakes. The code is supposed to create three new data object called `covid_inf`, `mean_inf`, and `median_inf` and report mean and median confirmed infections.    

- Correct 6 coding mistakes  
- Reference the previous slide for help  

```r
covid_inf <- covid %.% pull(confirmed_infection)

mean_inf < mean(covid_inf na.rm = TRUE)
median_inf <- covid_inf %>% median(na.rm = TRUE

mean_inf
medean_inf
```

## Troubleshooting your R code

**Exercise 4 - 5 minutes**  

This code contains 6 mistakes. The code is supposed to create three new data object called `covid_inf`, `mean_inf`, and `median_inf` and report mean and median confirmed infections.    

- Correct 6 coding mistakes  
- Reference the previous slide for help  

```{r, echo = TRUE, collapse=TRUE}
covid_inf <- covid %>% pull(confirmed_infections)

mean_inf <- mean(covid_inf, na.rm = TRUE)
median_inf <- covid_inf %>% median(na.rm = TRUE)

mean_inf
median_inf
```

## Practice with crime data

You wear many hats and are also a crime analyst at a think tank. For a report being prepared by the think tank, you need to analyze crime data.   

**Exercise 5 - 7 minutes**  
- What is the most recent `occurred_date`?  
- Which `neighborhood` sees the most incident activity?  
- What are the earliest and latest `reported_year` values?  

<b>Begin the exercise by importing the crime dataset in R Studio</b>  
```r
crime <- read_csv('https://rb.gy/5zuayh') 
```

## Practice with crime data

**Exercise 5 - 7 minutes**   
- What is the most recent `occurred_date`?  
- Which `neighborhood` sees the most incident activity?  
- What are the earliest and latest `reported_year` values?  

```{r, echo = TRUE, collapse=TRUE}
crime %>% pull(occurred_date) %>% max(na.rm = TRUE)
```

## Practice with crime data

**Exercise 5 - 7 minutes**  
- What is the most recent `occurred_date`?  
- Which `neighborhood` sees the most incident activity?  
- What are the earliest and latest `reported_year` values?  

```{r, echo = TRUE, collapse=TRUE}
crime %>% pull(occurred_date) %>% max(na.rm = TRUE)
crime %>% pull(neighborhood) %>% table() %>% sort() %>% tail()
```

## Practice with crime data {.smaller}

**Exercise 5 - 7 minutes**  
- What is the most recent `occurred_date`?  
- Which `neighborhood` sees the most incident activity?  
- What are the earliest and latest `reported_year` values?  

```{r, echo = TRUE, collapse=TRUE}
crime %>% pull(occurred_date) %>% max(na.rm = TRUE)
crime %>% pull(neighborhood) %>% table() %>% sort() %>% tail()
crime %>% pull(reported_year) %>% min(na.rm = TRUE)
crime %>% pull(reported_year) %>% max(na.rm = TRUE)
```
