<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Part 3 - Data Visualization with ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Graham Bearden" />
    <meta name="date" content="2021-10-28" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.5/countdown.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Part 3 - Data Visualization with ggplot2
### Graham Bearden
### University of Washington
### October 28, 2021

---


# Preamble

SAVE FOR ANSWERING QUESTIONS HELD OVER FROM THE PREVIOUS CLASS



---

# What we learned in the previous class

- A bit more about troubleshooting
- Chaining together functions with a pipe operator (`%&gt;%`)
- Selecting, creating, and updating variables  
- Subsetting tibbles/data frames  
- Aggregation  
- Dates

---

# What we'll learn today  

- Overview of ggplot2  
- Building bar, line, and scatter plots  
  - Aggregated data
  - Disaggregated data
- Customizing plots

---

# A reminder on troubleshooting

- Run code line by line  
- Ensure the code finished running (`+`s vs. `&gt;`s in the R console)  
- Red "x" annotation beside line numbers (after saving your file)

![](./figures/red_x_example.png)

---

# Troubleshooting exercise 

**Exercise 1 - 5 minutes**  

This code contains 4 mistakes. The code is supposed to report the mean, median, and max temperatures for Brazilian cities in the 19th and 20th centuries.      

--

```r
library(tidyverse)
        
climate &lt;- read_csv('https://bit.ly/3kKErEb')

climate %&gt;% 
  fitler(
    country == 'Brazil' 
    &amp; ! is.na(temp) 
    &amp; year &lt; 200
  ) %&gt;% 
  mutate(century = ifese(year &gt;= 1900, '20th Century', '19th Century')) %&gt;% 
  group_by(century, city) %&gt;% 
  summarise(
    mean_temp = mean(temp) 
    median_temp = median(temp)
    , max_temp = max(temp)
    ) %&gt;% 
  arrange(city)
```

<div class="countdown" id="timer_6171fa2f" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Troubleshooting exercise 

**Exercise 1 - 5 minutes**  

This code contains 4 mistakes. The code is supposed to report the mean, median, and max temperatures for Brazilian cities in the 19th and 20th centuries.      

![](figures/troubleshoot_solution_1.png)

---
class: inverse, middle, center

# Visualization with ggplot2

---

Import `airbnb` data if you have not already

```r
airbnb &lt;- read_csv('https://bit.ly/3oadz2L', col_types = cols())
```

---

# ggplot2

- Yardstick for plotting data in R  
- Part of the `tidyverse` collection of packages  
- Virtually no limits to plot types (when leveraging supplemental libraries)  
- Plotting resources  
  - [ggplot2 Launch Page](http://ggplot2.tidyverse.org/)
  - [Top 50 ggplot2 Visualizations](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html)

---

# Plot types

&lt;img src="figures/plots_1.png" style="height: 550px"/&gt;

---

# Plot types

![](figures/plots_2.png)

---

# Plot types

![](figures/plots_3.png)

---

# Plot types

What we will learn

&lt;img src="figures/bar.png" style="height: 200px"/&gt; &lt;img src="figures/stacked_bar.png" style="height: 200px"/&gt; &lt;img src="figures/hist.png" style="height: 200px"/&gt; &lt;img src="figures/scatter.png" style="height: 200px"/&gt; &lt;img src="figures/line.png" style="height: 200px"/&gt;

--

Requests to learn another plot type?

---

# Plot types

.pull-left[
1 discrete variable (plus other optional discrete and/or continuous variables)  

&lt;img src="figures/stacked_bar.png" style="height: 150px"/&gt; &lt;img src="figures/bar.png" style="height: 150px"/&gt;  

1 continuous variable  

&lt;img src="figures/hist.png" style="height: 150px"/&gt;  
]

.pull-right[
2 continuous variables  

&lt;img src="figures/scatter.png" style="height: 150px"/&gt;  

1 continuous variable + date variable  

&lt;img src="figures/line.png" style="height: 150px"/&gt;  
]

---

# Confirm that you can plot data 

```r
library(tidyverse)
mpg %&gt;% ggplot() + geom_point(aes(displ, hwy))
```

--

![](index_files/figure-html/unnamed-chunk-2-1.png)&lt;!-- --&gt;

---

# Confirm that you can plot data 

- If you see a plot, you're ready to go!  
- If you do not, reinstall `tidyverse` and re-run the test code

```r
install.packages('tidyverse')
library(tidyverse)
mpg %&gt;% ggplot(aes(displ, hwy))) + geom_point()
```

--

- If it still didn't work, install `ggplot2` and re-run the test code  

```r
install.packages('ggplot2')
library(ggplot2)
mpg %&gt;% ggplot(aes(displ, hwy)) + geom_point()
```

---

# How to plot data

1. Pick your data
2. Pick your chart type (geom)
3. Program stuff like chart titles, axis names, axis types, and legends (scales)  
4. Make it pretty (themes)
5. Keep tuning and reuse code

---

# Geoms

- Every plot needs a `ggplot()` function and a geom layer
- Separate layers and other plotting functions with `+`

```r
ggplot() + geom_bar()       # create bar and stacked bar plots
ggplot() + geom_histogram() # create histograms
ggplot() + geom_point()     # create scatter plots
ggplot() + geom_line()      # create line plots
```

--

- Your data is an argument in the `ggplot()` function  

```r
airbnb %&gt;% ggplot() + geom_bar()
ggplot(airbnb) + geom_bar()
```

---

# Geoms

- Map your data to the plot with `aes()`
  - `aes()` maps the variables in your data to the plot
  - `aes()` can be an argument in `ggplot()` or the geom  
  - Lots of `aes()` arguments

```r
airbnb %&gt;% ggplot(aes()) + geom_bar()
airbnb %&gt;% ggplot() + geom_bar(aes())
```

--

```r
aes(x = NULL, y = NULL, color = NULL
  , fill = NULL, alpha = NULL, label = NULL
  , shape = NULL, size = NULL, group = NULL
  , linetype = NULL
  )
```

---

# Geoms - Bar Plot

Map a character variable to `x`  


```r
airbnb %&gt;% ggplot(aes(x = address)) + geom_bar()
```

![](index_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---

# Geoms - Bar Plot

Map a character variable to `x`...and to `fill`


```r
airbnb %&gt;% ggplot(aes(x = address, fill = address)) + geom_bar()
```

![](index_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

---

# Geoms - Bar Plot

Map a second character variable to `fill` to build a stacked bar plot


```r
airbnb %&gt;% ggplot(aes(x = address, fill = room_type)) + geom_bar()
```

![](index_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

---

# Geoms - Bar Plot

Other handy features when building bar plots  
- `stat` in `geom_bar()`: "count" vs. "identity" 
- `position`in `geom_bar()`: "stacked" vs. "dodge"
- `coord_flip()`
- `reorder()`
- arguments outside of `aes()`

.pull-left[
```r
airbnb %&gt;% 
  ggplot(
    aes(
      x = address
      , fill = address
      )
    ) + 
  geom_bar()
```
]
.pull-right[

```r
airbnb %&gt;% 
* group_by(address) %&gt;%
* summarise(n = n()) %&gt;%
  ggplot(
    aes(
      x = address
*     , y = n
      , fill = address
      )
    ) + 
* geom_bar(stat = 'identity')
```
]
  
---

# Geoms - Bar Plot

Other handy features when building bar plots  
- `stat` in `geom_bar()`: "count" vs. "identity" 
- `position`in `geom_bar()`: "stacked" vs. "dodge"
- `coord_flip()`
- `reorder()`
- arguments outside of `aes()`

```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar(position = 'dodge')
```

--

```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar() + 
  coord_flip()
```

---

# Geoms - Bar Plot

Other handy features when building bar plots  
- `stat` in `geom_bar()`: "count" vs. "identity" 
- `position`in `geom_bar()`: "stacked" vs. "dodge"
- `coord_flip()`
- `reorder()`
- arguments outside of `aes()`

```r
airbnb %&gt;% 
  group_by(address) %&gt;%   
  summarise(n = n()) %&gt;%
  ggplot(
    aes(
      x = reorder(address, -n)
      , y = n  
      , fill = address
      )
    ) + 
  geom_bar(stat = 'identity') 
```

---

# Geoms - Bar Plot

Other handy features when building bar plots  
- arguments outside of `aes()`


```r
my_data &lt;- airbnb %&gt;% 
  group_by(address) %&gt;% 
  summarise(n = n())

mean_count &lt;-  my_data %&gt;%
  pull(n) %&gt;% 
  mean()

my_data %&gt;% 
  ggplot(
    aes(
      x = reorder(address, -n)
      , y = n  
      )
    ) + 
  geom_bar(
*   stat = 'identity', fill = '#CC3F0C' # coolors.co/generate
*   , linetype = 'dashed', color = 'black', size = 1
    ) + 
* geom_hline(yintercept = mean_count, size = 1, color = '#FFBA08')
```

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
