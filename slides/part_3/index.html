<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Part 3 - Data Visualization with ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Graham Bearden" />
    <meta name="date" content="2022-10-18" />
    <script src="libs/header-attrs-2.16/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/countdown-0.4.0/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.4.0/countdown.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Part 3 - Data Visualization with ggplot2
]
.author[
### Graham Bearden
]
.institute[
### University of Washington
]
.date[
### October 18, 2022
]

---


# Housekeeping

- Reminder: Submit 2 “stakeholder-ready” data visualizations on November 4 or before  
  - See examples [here](https://github.com/gbearden/r_course_evans_school/blob/master/plots/) on Github  
- You only need to install packages once (`install.packages('tidyverse')`)  



---

# What we learned in the previous class

- A bit more about troubleshooting
- Chaining together functions with a pipe operator (`%&gt;%`)
- Selecting, creating, and updating variables  
- Subsetting tibbles/data frames  

---

# What we'll learn today  

- Overview of ggplot2  
- How to aggregate data  
- Building bar, line, and scatter plots  
  - Aggregated data
  - Disaggregated data
- Customizing plots

---

# A reminder on troubleshooting

- Run code line by line  
- Ensure the code finished running (`+`s vs. `&gt;`s in the R console)  
- Red "x" annotation beside line numbers (after saving your file)

![](./figures/red_x_example.png)

---

# Troubleshooting exercise 

**Exercise 1 - 5 minutes**  

This code contains 3 mistakes. The code is supposed to report the mean temperatures for Peru and Saudi Arabia before 1900.  

--

```r
library(tidyverse)
        
climate &lt;- read_csv('https://bit.ly/3kKErEb')

saudi &lt;- climate %&gt;% 
  fiter(year &lt; 1900 &amp; country == 'Saudi Arabia')

peru &lt;- climate %&gt;% 
  filter(year &lt; 1900 &amp; country = 'Peru')

saudi %&gt;% pull(temp) %&gt;% mean(na.rm = TRUE)
peru %&gt;% pull(temp) %&gt;% mean(rm.na = TRUE)
```

<div class="countdown" id="timer_03affaa4" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Troubleshooting exercise 

**Exercise 1 - 5 minutes**  

This code contains 3 mistakes. The code is supposed to report the mean temperatures for Peru and Saudi Arabia before 1900.  

![](figures/troubleshoot_solution_1.png)

---
class: inverse, middle, center

# Visualization with ggplot2

---

# ggplot2

Import `airbnb` data if you have not already

```r
airbnb &lt;- read_csv('https://bit.ly/3oadz2L')
```

---

# ggplot2

- Yardstick for plotting data in R  
- Part of the `tidyverse` collection of packages  
- Virtually no limits to plot types (when leveraging supplemental libraries)  
- Plotting resources  
  - [ggplot2 Launch Page](http://ggplot2.tidyverse.org/)
  - [Top 50 ggplot2 Visualizations](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html)

---

# Plot types

What we will learn

&lt;img src="figures/bar.png" style="height: 200px"/&gt; &lt;img src="figures/stacked_bar.png" style="height: 200px"/&gt; &lt;img src="figures/hist.png" style="height: 200px"/&gt; &lt;img src="figures/scatter.png" style="height: 200px"/&gt; &lt;img src="figures/line.png" style="height: 200px"/&gt;

---

# Plot types

.pull-left[
1 discrete variable (plus optional discrete and/or continuous variables)  

&lt;img src="figures/stacked_bar.png" style="height: 150px"/&gt; &lt;img src="figures/bar.png" style="height: 150px"/&gt;  

1 continuous variable  

&lt;img src="figures/hist.png" style="height: 150px"/&gt;  
]

.pull-right[
2 continuous variables  

&lt;img src="figures/scatter.png" style="height: 150px"/&gt;  

1 continuous variable + ordinal variable  

&lt;img src="figures/line.png" style="height: 150px"/&gt;  
]

---

# Plot types

![](figures/plots_3.png)

---

# Plot types

&lt;img src="figures/plots_1.png" style="height: 550px"/&gt;

---

# Plot types

![](figures/plots_2.png)

---

# Confirm that you can plot data 

```r
library(tidyverse)
mpg %&gt;% ggplot() + geom_point(aes(displ, hwy))
```

--

![](index_files/figure-html/unnamed-chunk-2-1.png)&lt;!-- --&gt;

---

# Confirm that you can plot data 

- If you see a plot, you're ready to go!  
- If you do not, reinstall `tidyverse` and re-run the test code

```r
install.packages('tidyverse')
library(tidyverse)
mpg %&gt;% ggplot(aes(displ, hwy))) + geom_point()
```

--

- If it still didn't work, install `ggplot2` and re-run the test code  

```r
install.packages('ggplot2')
library(ggplot2)
mpg %&gt;% ggplot(aes(displ, hwy)) + geom_point()
```

---

# How to plot data

1. Pick your data
2. Pick your chart type (geom)
3. Write code for stuff like chart titles, axis names, axis types, and legends (scales)  
4. Make it pretty (themes)
5. Keep tuning and reuse code

---

# Geoms

- Every plot needs a `ggplot()` function and a geom layer
- Separate layers and other plotting functions with `+`

```r
ggplot() + geom_bar()       # create bar and stacked bar plots
ggplot() + geom_histogram() # create histograms
ggplot() + geom_point()     # create scatter plots
ggplot() + geom_line()      # create line plots
```

--

- Your data is an argument in the `ggplot()` function  

```r
airbnb %&gt;% ggplot() + geom_bar() # ggplot(data = airbnb) + geom_bar()
```

---

# Geoms

- Map your data to the plot with `aes()`
  - `aes()` maps the variables in your data to the plot
  - `aes()` can be an argument in `ggplot()` or the geom  
  - In simpler plots, `aes()` should be a `ggplot()` argument
  - Lots of `aes()` arguments

```r
airbnb %&gt;% ggplot(aes()) + geom_bar()
airbnb %&gt;% ggplot() + geom_bar(aes()) # Alternate placement of aes()
```

--

```r
aes(x = NULL, y = NULL, color = NULL
  , fill = NULL, alpha = NULL, linetype = NULL
  , shape = NULL, size = NULL
  )
```

---

# Geoms - Bar Plot

Map a character variable to `x`  


```r
airbnb %&gt;% ggplot(aes(x = address)) + geom_bar()
```

![](index_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---

# Geoms - Bar Plot

Map a character variable to `x`...and to `fill`


```r
airbnb %&gt;% ggplot(aes(x = address, fill = address)) + geom_bar()
```

![](index_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

---

# Geoms - Bar Plot

Map a second character variable to `fill` to build a stacked bar plot


```r
airbnb %&gt;% ggplot(aes(x = address, fill = room_type)) + geom_bar()
```

![](index_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

---

# Geom - Bar Plot

**Exercise**  
- Build a bar chart with `climate` data that shows the number of rows for the following countries: 'Brazil', 'China', 'India', 'Turkey', and 'United States'
- To complete the task, you'll need to:
  - Subset your data using `filter()` (click [here](https://gbearden.github.io/r_course_evans_school/slides/part_2/#44) for help)  
  - Set the color of the bars equal to `country`
  
```r
climate &lt;- read_csv('https://bit.ly/3kKErEb')
```
  

<div class="countdown" id="timer_33ad7719" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">07</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Geom - Bar Plot

**Exercise**  
- Build a bar chart with `climate` data that shows the number of rows for the following countries: 'Brazil', 'China', 'India', 'Turkey', and 'United States'
- To complete the task, you'll need to:
  - Subset your data using `filter()` (click [here](https://gbearden.github.io/r_course_evans_school/slides/part_2/#44) for help)  
  - Set the color of the bars equal to `country`
  
```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  ggplot(aes(x = country, fill = country)) + 
  geom_bar()
```

---

# Geom - Bar Plot


```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  ggplot(aes(x = country, fill = country)) + 
  geom_bar()
```

![](index_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;

---
class: inverse, middle, center

# Aggregate data with group_by() and summarise()

---

# group_by() and summarise() 

- Count, sum, average, and identify max and min values  
- Powerful in combination with plotting code!  
- Example questions you could answer
  - In `airbnb`, on **average** which city is most costly per night?   
  - In `airbnb`, **how many** listings of each room type are there?
  - In `airbnb`, what's **the total** number of people to stay in each room type?  
  - In `climate`, what's the **average** temperature by year in cities in China?  
  - In `climate`, what's the **smallest** level of uncertainty by year and country?  

---

# group_by() and summarise()  

- In `group_by()`, list the variables by which you want to aggregate data
- In `summarise()`, create a variable and define the variable with an aggregation function
- Use `%&gt;%` to 'link' `group_by()` and `summarise()`
- Aggregation functions
  - `n()`, `n_distinct()`, `sum()`, `mean()`, `max()`, `min()`  
- Perform multiple aggregations in a single `summarise()` function  

--

**Example**  
In `airbnb`, on average which city is most costly per night?   

--

```r
airbnb %&gt;% 
  group_by(address) %&gt;% 
  summarise(mean_cost = mean(price))
```

---

# group_by() and summarise()  

**Example**  
In `airbnb`, how many listings of each room type are there?

--

```r
airbnb %&gt;% 
  group_by(room_type) %&gt;% 
  summarise(n_listings = n())
```

--

How do you update the code to count the number of room type listings by city?

--

```r
airbnb %&gt;% 
  group_by(room_type, address) %&gt;% 
  summarise(n_listings = n())
```

--

How do you further update the code to only see rows for Kirkland?

--

```r
airbnb %&gt;% 
  group_by(room_type, address) %&gt;% 
  summarise(n_listings = n()) %&gt;% 
  filter(address == 'Kirkland')
```

---

# group_by() and summarise()  

**Example**  
In `airbnb`, how many listings of each room type are there?

```r
airbnb %&gt;% 
  group_by(room_type, address) %&gt;% 
  summarise(n_listings = n()) %&gt;% 
  filter(address == 'Kirkland')
```

Building on the code above, how would you create a variable that indicates whether there is a deficit of listings for the three `room_types` (let's say "deficit" is defined as fewer than 100 hosts)?

---

# group_by() and summarise()  

**Example**  
In `airbnb`, how many listings of each room type are there?

Building on the code above, how would you create a variable that indicates whether there is a deficit of listings for the three `room_types` (let's say "deficit" is defined as fewer than 100 hosts)?

```r
airbnb %&gt;% 
  group_by(room_type, address) %&gt;% 
  summarise(n_listings = n()) %&gt;% 
  filter(address == 'Kirkland') %&gt;% 
  mutate(listings_deficit = ifelse(n_listings &lt; 100, 'y', 'n'))
```

---

# group_by() and summarise() + ggplot()

`stat` in `geom_bar()`: "count" vs. "identity"  
- `stat = 'count'` tells R to count the number of rows for values in `x` and visualize them  
- `stat = 'identity'` tells R to visualize the number in `y`  

.pull-left[
```r
airbnb %&gt;% 
  ggplot(
    aes(
      x = address
      , fill = address
      )
    ) + 
  geom_bar()
```]  
.pull-right[

```r
  airbnb %&gt;% 
*   group_by(address) %&gt;%
*   summarise(count = n()) %&gt;%
    ggplot(
      aes(
        x = address
*       , y = count
        , fill = address
        )
      ) + 
*   geom_bar(stat = 'identity')
```
]

---

# Exercise

Create a bar plot from the data frame containing the aggregated data that we just produced. Set the color of the bars to be equal to the listing deficit variable.  

```r
airbnb %&gt;% 
  group_by(room_type, address) %&gt;% 
  summarise(n_listings = n()) %&gt;% 
  filter(address == 'Kirkland') %&gt;% 
  mutate(listings_deficit = ifelse(n_listings &lt; 100, 'y', 'n'))
```

<div class="countdown" id="timer_f6a5cead" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# group_by() and summarise() + ggplot()


```r
airbnb %&gt;% 
  group_by(room_type, address) %&gt;% 
  summarise(n_listings = n()) %&gt;% 
  filter(address == 'Kirkland') %&gt;% 
  mutate(listings_deficit = ifelse(n_listings &lt; 100, 'y', 'n')) %&gt;% 
  ggplot(aes(x = room_type, y = n_listings, fill = listings_deficit)) + 
  geom_bar(stat = 'identity')
```

![](index_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---

# Geoms - Bar Plot

Other handy features when building bar plots  
- `position`in `geom_bar()`: "stacked" vs. "dodge"
- `reorder()`
- arguments outside of `aes()`


```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
* geom_bar(position = 'dodge')
```

---

# Geoms - Bar Plot

Other handy features when building bar plots  
- `position`in `geom_bar()`: "stacked" vs. "dodge"
- `reorder()`
- arguments outside of `aes()`


```r
airbnb %&gt;% 
  group_by(address) %&gt;%   
  summarise(n = n()) %&gt;%
  ggplot(
    aes(
*     x = reorder(address, -n)
      , y = n  
      , fill = address
      )
    ) + 
  geom_bar(stat = 'identity') 
```

---

# Geoms - Bar Plot

Other handy features when building bar plots  
- `position`in `geom_bar()`: "stacked" vs. "dodge"
- `reorder()`
- arguments outside of `aes()`


```r
my_data &lt;- airbnb %&gt;% 
  group_by(address) %&gt;% 
  summarise(n = n())

my_data %&gt;% 
  ggplot(
    aes(
      x = reorder(address, -n)
      , y = n  
      )
    ) + 
  geom_bar(
*   stat = 'identity', fill = '#CC3F0C', alpha = .5 # coolors.co/generate
*   , linetype = 'dashed', color = 'black', size = 1
    ) 
```

---

# Exercise

- Update the bar chart you built that shows the number of rows for 'Brazil', 'China', 'India', 'Turkey', and 'United States'
  - The updated version of the plot should use `group_by()` and `summarise()` and `stat` should be `'identity'` in `geom_bar()`
  - Use `reorder()` to update the order of the bars  

<div class="countdown" id="timer_7a39f7f4" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
  
--
  
```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity')
```

---

# Geom - Bar Plot


```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity')
```

![](index_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

---
class: inverse, middle, center

# Scales

---

# Axis, legend, and chart titles

Axis names  

- Keep names short-ish  
- Consider including units in axis name  
- It is possible you don't need an axis name

2 options

```r
# Option 1
labs(x = 'X Axis Title', y = 'Y Axis Title')

# Option 2
xlab('X Axis Title')
ylab('Y Axis Title')
```

---

# Axis, legend, and chart titles


```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar() + 
  labs(x = 'City', y = 'Number of Rentals (#)')
```

![](index_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

# Axis, legend, and chart titles

Try adding axis names to the plot of countries made from the `climate` data

--


```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity') + 
  labs(x = 'Country', y = 'Number of Countries (#)')
```

![](index_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

# Axis, legend, and chart titles

Legend names  

- Keep names short  
- Be mindful of what the legend is for
  - Color? Fill? Size? etc.
- Consider hiding the legend title for a clean look  

```r
labs(fill = '')
labs(fill = element_blank())
labs(fill = NULL)
labs(colour = 'Check out these colors')
```

---

# Axis, legend, and chart titles


```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar() + 
  labs(x = 'City', y = 'Number of Rentals (#)', fill = 'Check out these colors')
```

![](index_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;

---

# Axis, legend, and chart titles 

Try removing the legend name from the plot of countries made from the `climate` data

--


```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity') + 
  labs(x = 'Country', y = 'Number of Observations (#)', fill = element_blank())
```

![](index_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;

---

# Axis, legend, and chart titles 

Chart titles and subtitles

- Consider making titles (or subtitles) descriptive
- Don't over use subtitles

```r
# Option 1
labs(title = NULL, subtitle = NULL)

# Option 2
ggtitle(title = NULL, subtitle = NULL)
```

---

# Axis, legend, and chart titles

```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar() + 
  labs(
    x = 'City'
    , y = 'Number of Rentals (#)'
    , fill = 'Check out these colors'
    , title    = 'Room Types by City'
    , subtitle = 'Shared Rooms are the Least Available Room Type'
    )
```

---

# Axis, legend, and chart titles

![](index_files/figure-html/unnamed-chunk-20-1.png)&lt;!-- --&gt;

---

# Axis, legend, and chart titles

Try adding a title to the plot of countries made from the `climate` data

--

```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity') + 
  labs(
    x = 'Country'
    , y = 'Number of Observations (#)'
    , fill = element_blank()
    , title = 'Number of observations by country'
    )
```

---

# Axis, legend, and chart titles

Try adding a title to the plot of countries made from the `climate` data

![](index_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;

---

# Axis units

- Change axis units
- This is a good idea and you should do it when its relevant
- Good for x and y axes

```r
install.packages('scales')
library(scales)

scale_y_continuous(labels = percent) # Add a percentage sign to numbers on axis
scale_y_continuous(labels = dollar)  # Add a dollar sign to numbers on axis
scale_y_continuous(labels = comma)   # Add a comma to numbers on axis
```

---

# Axis units

```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar() + 
  labs(
    x = 'City'
    , y = 'Number of Rentals (#)'
    , fill = 'Check out these colors'
    , title    = 'Room Types by City'
    , subtitle = 'Shared Rooms are the Least Available Room Type'
    ) + 
  scale_y_continuous(labels = comma) 
```

---

# Axis units

![](index_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;

---

# Axis units

Try adding commas to the y-axis of the plot you made from the `climate` data

--

```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity') + 
  labs(
    x = 'Country'
    , y = 'Number of Observations (#)'
    , fill = element_blank()
    , title = 'Number of observations by country'
    ) + 
  scale_y_continuous(labels = comma) 
```

---

# Axis units

Try adding commas to the y-axis of the plot you made from the `climate` data

![](index_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---
class: inverse, middle, center

# Themes

---

# Themes

- Change layer and background colors
- Change fonts
- Change plot borders/boundaries and ticks
- Pre-built themes vs. custom themes
  - `ggplot2` and `ggthemes` themes

```r
install.packages('ggthemes')
library(ggthemes)
```

---

# Pre-built themes

Selected `ggplot2` themes

```r
theme_classic()
theme_bw()
theme_minimal()
theme_dark()
```  
Selected `ggthemes` themes

```r
theme_stata() + scale_colour_stata() # also can use scale_fill_stata()
theme_economist() + scale_colour_economist() 
theme_fivethirtyeight() + scale_color_fivethirtyeight() 
theme_wsj() + scale_colour_wsj() 
theme_pander() + scale_colour_pander() 
theme_hc(bgcolor = "darkunica") + scale_colour_hc("darkunica") 
```

---

# Pre-built themes

```r
airbnb %&gt;% 
  ggplot(aes(x = address, fill = room_type)) + 
  geom_bar() + 
  labs(
    x = 'City'
    , y = 'Number of Rentals (#)'
    , fill = 'Check out these colors'
    , title    = 'Room Types by City'
    , subtitle = 'Shared Rooms are the Least Available Room Type'
    ) + 
  scale_y_continuous(labels = comma) + 
  theme_economist() + 
  scale_fill_economist()
```

---

# Pre-built themes

Economist theme  
  
![](index_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;

---

# Pre-built themes

&lt;img src="figures/plot_themes.png" style="height: 500px"/&gt;  

---

# Pre-built themes

Try adding a theme to the plot you made from the `climate` data

--

```r
climate %&gt;% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States')) %&gt;% 
  group_by(country) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) + 
  geom_bar(stat = 'identity') + 
  labs(
    x = 'Country'
    , y = 'Number of Observations (#)'
    , fill = element_blank()
    , title = 'Number of observations by country'
    ) + 
  scale_y_continuous(labels = comma) +
  theme_wsj() + 
  scale_fill_wsj()
```

---

# Pre-built themes

Try adding a theme to the plot you made from the `climate` data

![](index_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;

---

# Custom themes

- You can create custom themes with `theme()`
- Greater control over chart aesthestics
- Use custom themes in place of pre-built themes if pre-built themes don't cut it
- Also, use custom themes to augment pre-built themes

---

# Custom themes

```r
theme(
  plot.title         = element_text(size=14, face="bold", vjust=1)
  , plot.background  = element_blank()
  , panel.grid.major = element_blank()
  , panel.grid.minor = element_blank()
  , panel.border     = element_blank()
  , panel.background = element_blank()
  , axis.ticks       = element_blank()
  , axis.text        = element_text(colour="black", size=12)
  , axis.text.x      = element_text(angle=45, hjust=1)
  , legend.title     = element_blank()
  , legend.position  = "none"
  , legend.text      = element_text(size=12)
  )
  
help(theme)
```

---

# Exercise

The code on the right produces a data frame from which you'll build a plot. 

.pull-left[
- Visualize the data as a bar plot
- The x-axis should equal `city`
- The y-axis should equal `mean_temp`
- `fill` should be `century`
- Dodge the bar segments
- Feel free to use a theme, title the plot, update axis titles, or make an other aesthetic changes
]

.pull-right[
```r
climate %&gt;% 
  filter(
    country == 'Brazil' 
    &amp; ! is.na(temp) 
    &amp; year &lt; 2000
  ) %&gt;% 
  mutate(century = ifelse(year &gt;= 1900, '20th Century', '19th Century')) %&gt;% 
  group_by(century, city) %&gt;%   
  summarise(
    mean_temp = mean(temp) 
    , median_temp = median(temp)
    , max_temp = max(temp)
  ) %&gt;% 
  arrange(city)
```
]

<div class="countdown" id="timer_f684d6cd" data-update-every="1" tabindex="0" style="bottom:0;left:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">07</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise 

```r
climate %&gt;% 
  filter(
    country == 'Brazil' 
    &amp; ! is.na(temp) 
    &amp; year &lt; 2000
  ) %&gt;% 
  mutate(century = ifelse(year &gt;= 1900, '20th Century', '19th Century')) %&gt;% 
  group_by(century, city) %&gt;%   
  summarise(
    mean_temp = mean(temp) 
    , median_temp = median(temp)
    , max_temp = max(temp)
  ) %&gt;% 
  arrange(city) %&gt;% 
  ggplot(aes(x = reorder(city, mean_temp), y = mean_temp, fill = century)) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  labs(x = 'City', y = 'Mean Temperature (Celcius)', fill = NULL) + 
  theme_hc() + 
  scale_fill_hc()
```

---

# Exercise 

![](index_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
