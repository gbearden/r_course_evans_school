<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Part 2 - Introduction to the Tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Graham Bearden" />
    <meta name="date" content="2025-10-16" />
    <script src="libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/countdown-0.4.0/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.4.0/countdown.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Part 2 - Introduction to the Tidyverse
]
.author[
### Graham Bearden
]
.institute[
### University of Washington
]
.date[
### October 16, 2025
]

---




# Questions from last class

- How do I create pdf outputs in R Notebook? 
  - Check out [tinytex](https://yihui.org/tinytex/)
- Also, create PPTX outputs
  - Check out [officer](https://davidgohel.github.io/officer/)

---

# What we learned in the previous class

- Getting up and running in RStudio  
- Core R concepts  
  - Data types
  - Relationship between data and functions  
- How to import data  
- Regularly used data summary functions  
- Assignment operator (`&lt;-`)

---

# What we'll learn today  

- Creating and updating variables  
- Subsetting tibbles/data frames  
- Aggregation  
- Reshaping (or pivoting) data

---

# Troubleshooting tips

Make sure...

- You loaded your libraries
- Check spelling
- Arguments in your functions are comma-separated
- Ensure the code finished running (`+`s vs. `&gt;`s in the R console)  
  - Your functions should have start and closing parentheses
  - Check for red "x" annotation beside line numbers (after saving your file)
  - You have start and end quotation marks where relevant
- The variable type is correct to perform the function you call
  - For example you probably don't want to run `min()` on a character string
- Your assignment operator looks like this: `&lt;-`
- Run code line by line  

--

Also, feel free to ask an AI assistant why you see an error!

```
Why does this code throw an error in R? 
[Your code]
```

---

# Refresher with MBA admissions data

You can find the a description of the MBA admissions data [here](https://www.kaggle.com/datasets/taweilo/mba-admission-dataset). The data were generated from the University of Pennsylvania Wharton Class of 2025. Use functions to explore [tibbles](https://gbearden.github.io/r_course_evans_school/slides/part_1/#30) and [vectors](https://gbearden.github.io/r_course_evans_school/slides/part_1/#37) from the previous class to help answer these questions.

--

**Exercise 1 - 5 minutes**  
- What is the lowest `gpa` in the `mba` tibble?  
- What is the average number of years of work experience (`work_exp`)?  
- How many applicants are international students?  
- In how many rows in the tibble is "Consulting" the `work_industry` value?  

--

&lt;b&gt;Begin the exercise by importing the mba admissions data in R Studio&lt;/b&gt;  
```r
mba &lt;- read_csv("https://bit.ly/4evYpeW")
```

<div class="countdown" id="timer_e0340518" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Refresher with MBA admissions data

**Exercise 1 - 5 minutes**  
- What is the lowest `gpa` in the `mba` tibble?  
- What is the average number of years of work experience (`work_exp`)?  
- How many applicants are international students?  
- In how many rows in the tibble is Consulting the `work_industry` value?  


``` r
min(mba$gpa)
## [1] 2.65
```

--


``` r
mean(mba$work_exp, na.rm = TRUE)
## [1] 5.016952
```

--


``` r
table(mba$international)
## 
## FALSE  TRUE 
##  4352  1842
```

---

# Refresher with MBA admissions data

**Exercise 1 - 8 minutes**  
- What is the lowest `gpa` in the `mba` tibble?  
- What is the average number of years of work experience (`work_exp`)?  
- How many applicants are international students?  
- In how many rows in the tibble is Consulting the `work_industry` value?  


``` r
table(mba$work_industry)['Consulting']
## Consulting 
##       1619
```

---
class: inverse, middle, center

# Select, create, and rename variables

---

# &lt;span style="color:#6DA34D"&gt;Select&lt;/span&gt;, create, and rename variables 

- `select()` keeps the named variables from the tibble
- You can remove variables from the tibble with `-`
- You may use [selection helpers](https://dplyr.tidyverse.org/reference/select.html)
  - For example, `everything()`
- Use `'``'` for multi-word variables and variable names that begin with numbers

--

```r
airbnb &lt;- read_csv('https://bit.ly/3oadz2L', col_types = cols())

select(airbnb, host_id, reviews, rating, price)
```

&lt;table class=" lightable-classic table" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; width: auto !important; float: left; margin-right: 10px;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; host_id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reviews &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rating &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; price &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2536 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4193 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 35749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---

# &lt;span style="color:#6DA34D"&gt;Select&lt;/span&gt;, create, and rename variables 

- `select()` keeps the named variables from the tibble
- You can remove variables from the tibble with `-`
- You may use [selection helpers](https://dplyr.tidyverse.org/reference/select.html)
  - For example, `everything()`
- Use `'``'` for multi-word variables and variable names that begin with numbers

```r
airbnb_2 &lt;- select(airbnb, host_id, reviews, rating, price)
select(airbnb_2, -rating)
```

&lt;table class=" lightable-classic table" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; width: auto !important; float: left; margin-right: 10px;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; host_id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reviews &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; price &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2536 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4193 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 35749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---

# &lt;span style="color:#6DA34D"&gt;Select&lt;/span&gt;, create, and rename variables

- `select()` keeps the named variables from the tibble
- You can remove variables from the tibble with `-`
- You may use [selection helpers](https://dplyr.tidyverse.org/reference/select.html)
  - For example, `everything()`
- Use `'``'` for multi-word variables and variable names that begin with numbers

```r
airbnb_2 &lt;- select(airbnb, host_id, reviews, rating, price)
select(airbnb_2, host_id, price, everything())
```

&lt;table class=" lightable-classic table" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; width: auto !important; float: left; margin-right: 10px;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; host_id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; price &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reviews &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rating &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2536 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4193 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 35749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.5 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---

# Make your code as readable as possible

- A whole course could be taught on how to format code
- For our course, use the pipe operator (`|&gt;`) when working with **tibbles/data frames**  

--

**Bad** 
```r
select(select(airbnb, host_id, reviews, rating, price), host_id, price, everything())
```

**Good** 
```r
airbnb |&gt;
  select(host_id, reviews, rating, price) |&gt; 
  select(host_id, price, everything()) 
```

**Use pipes if possible, but this is okay** 
```r
airbnb_2 &lt;- select(airbnb, host_id, reviews, rating, price)
select(airbnb_2, host_id, price, everything()) 
```

---

# Make your code as readable as possible

- Use the pipe operator (`|&gt;`) when working with **tibbles/data frames**  
  - Easier to read and troubleshoot  
  - Easier to comment (write end of line comments or above line comments)
  - Modular
  - Makes data management within your script easier  
  - Style-wise, pipes are the present and future
- Do not use the operator when you need to:  
  - Refer to a data object created in an intermediate step
  - Process more than 1 distinct data object

```r
airbnb |&gt;
  select(host_id, reviews, rating, price) |&gt; 
  select(host_id, price, everything()) 
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- `mutate()` creates variables  
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`

--

```r
airbnb |&gt; 
  mutate(
    cost_per_num_accom = price / accommodates,
    mean_price = mean(price)
    ) 
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

- `mutate()` creates variables
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`

```r
x &lt;- c(1, 2, 3)
y &lt;- c(4, 5, 1)

if_else(x &gt; y, 'yes', 'no')
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- `mutate()` creates variables
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`


``` r
x &lt;- c(1, 2, 3)
y &lt;- c(4, 5, 1)

if_else(x &gt; y, 'yes', 'no')
## [1] "no"  "no"  "yes"
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- A little more on `if_else()`  
  - A logical test with a true-or-false outcome
  - To make comparisons use: `==`, `&lt;`, `&lt;=`, `&gt;`, `&gt;=`, `!=`, `%in%`, `!`, `is.na()`
     - `==` 1 to 1 equivalency test
     - `%in%` lets you search for equivalency over a string
  - Concatenate values with `c()`

--


``` r
city_1 &lt;- 'San Francisco'
city_2 &lt;- 'Portland'
california &lt;- c('San Francisco', 'Los Angeles', 'San Diego')

if_else(city_1 %in% california, 'yes', 'no')
## [1] "yes"
if_else(city_2 %in% california, 'yes', 'no')
## [1] "no"
if_else(237 %in% 200:300, 'yes', 'no')
## [1] "yes"
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- A little more on `if_else()`  
  - A logical test with a true-or-false outcome
  - To make comparisons use: `==`, `&lt;`, `&lt;=`, `&gt;`, `&gt;=`, `!=`, `%in%`, `!`, `is.na()`
     - `==` 1 to 1 equivalency test
     - `%in%` lets you search for equivalency over a string
  - Concatenate values with `c()`


``` r
city_1 &lt;- 'San Francisco'
city_2 &lt;- 'Portland'
california &lt;- c('San Francisco', 'Los Angeles', 'San Diego')

if_else(! city_1 %in% california, 'yes', 'no')
## [1] "no"
if_else(! city_2 %in% california, 'yes', 'no')
## [1] "yes"
if_else(! 237 %in% 200:300, 'yes', 'no')
## [1] "no"
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- `mutate()` creates variables
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`

```r
airbnb |&gt; 
  mutate(
    cost_per_num_accom = price / accommodates,
    mean_price = mean(price),
    seattle_address = if_else(address == 'Seattle', 'y', NA),
    large = if_else(accommodates &gt; 5, 'y', NA)
    ) 
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

```r
airbnb |&gt; 
  mutate(
    cost_per_num_accom = price / accommodates,
    mean_price = mean(price),
    seattle_address = if_else(address == 'Seattle', 'y', NA),
    large = if_else(accommodates &gt; 5, 'y', NA)
    ) |&gt;
  select(room_id, host_id, cost_per_num_accom, mean_price, seattle_address, large)
```


```
## # A tibble: 5 × 6
##   room_id host_id cost_per_num_accom mean_price seattle_address large
##     &lt;dbl&gt;   &lt;dbl&gt;              &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;
## 1    2318    2536               31.2       112. y               y    
## 2    3335    4193               25         112. y               &lt;NA&gt; 
## 3    4291   35749               41         112. y               &lt;NA&gt; 
## 4    5682    8993               24.5       112. y               &lt;NA&gt; 
## 5    6606   14942               45         112. y               &lt;NA&gt;
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

By day you're an analyst at the City of Seattle; by night you're a climate analyst at the Earth Institute. You will analyze [climate data](https://www.kaggle.com/sohelranaccselab/global-climate-change) to answer questions that help the Earth Institute understand temperature and temperature change in cities and countries around the world.

**Exercise - 6 minutes**  
- With the `climate` data, create variables called `high_uncertainty` and `winter`
- In `high_uncertainty`, flag with a `1` all observations where `uncertainty` is greater than 1.5. All other rows should have a `0`.  
- In `winter`, flag with a `1` all observations where month is a 1, 2, 12.  
- Only report the following variables in the output: `country`, `city`, `high_uncertainty` and `winter`

--

```r
climate &lt;- read_csv('https://bit.ly/3kKErEb')
```

<div class="countdown" id="timer_c730d475" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">06</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

&lt;b&gt;Exercise - 6 minutes&lt;/b&gt;  
- With the `climate` data, create variables called `high_uncertainty` and `winter`
- In `high_uncertainty`, flag with a `1` all observations where `uncertainty` is greater than 1.5. All other rows should have a `0`  
- In `winter`, flag with a `1` all observations where month is a 1, 2, 12.  
- Only report the following variables in the output: `country`, `city`, `high_uncertainty` and `winter`

```r
climate |&gt; 
  mutate(
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    ) |&gt;
  select(country, city, high_uncertainty, winter)
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

```r
climate |&gt; 
  mutate(
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    ) |&gt;
  select(country, city, high_uncertainty, winter)
```


```
## # A tibble: 6 × 4
##   country     city    high_uncertainty winter
##   &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;
## 1 Ivory Coast Abidjan                0      1
## 2 Ivory Coast Abidjan                0      1
## 3 Ivory Coast Abidjan                1      0
## 4 Ivory Coast Abidjan                0      0
## 5 Ivory Coast Abidjan                0      0
## 6 Ivory Coast Abidjan                0      0
```

&lt;div class="animate__animated animate__bounce" style="color: #363457; background-color: white"&gt;
  &lt;p id="clickToShow" style="display: none;"&gt;Nice job! Now take a moment to ask ChatGPT to annotate your code.&lt;/p&gt;
  &lt;button id="revealButton"&gt;Do Not Push&lt;/button&gt;
&lt;/div&gt;

&lt;script&gt;
// JavaScript to reveal the hidden text on button click
document.getElementById('revealButton').addEventListener('click', function() {
  document.getElementById('clickToShow').style.display = 'block';
});
&lt;/script&gt;

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

- `transmute()` = `mutate()` + `select()`

--

```r
climate |&gt; 
  mutate(
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    ) |&gt;
  select(country, city, high_uncertainty, winter)
```

--

```r
climate |&gt; 
  transmute(
    country,
    city,
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    )
```

---

# Exercise: Troubleshooting

This code contains 3 mistakes. The code is supposed to create a new tibble called `bathrooms`. Find the 3 mistakes and correct them. Find the mistakes on your own, with a friend, and/or ask an AI assistant to help.   

```r
library(tinyverse)

bathrooms &lt;- airbnb %&gt; 
  transmute(
  rental = room_id, 
  room_type, 
  bathrooms
  bathrooms_2_more = bathrooms &gt;= 2,
  price_per_bathroom = price / bathrooms
  ) 
  
head(bathrooms)
```

<div class="countdown" id="timer_a50bec94" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Select, create, and &lt;span style="color:#6DA34D"&gt;rename&lt;/span&gt; variables 

- `rename()` assigns a new name to an existing variable
- Renaming is possible with `transmute()` and `mutate()`as well
  - `rename()`: renames selected variables, keeps all other variables
  - `transmute()`: renames selected variables, drops all other variables
  - `mutate()`: creates new variables (with new names) and keeps originals
- Each variable transformation is comma-separated  

**Example**
- How do I rename `address` as `city`, `price` as `cost`, and `name` as `description` with one of the methods in `airbnb`?

--

```r
airbnb |&gt; 
  rename(
    city = address,
    cost = price,
    description = name
    ) 
```

---

# Select, create, and &lt;span style="color:#6DA34D"&gt;rename&lt;/span&gt; variables 

- `rename()` assigns a new name to an existing variable
- Renaming is possible with `transmute()` and `mutate()`as well
  - `rename()`: renames selected variables, keeps all other variables
  - `transmute()`: renames selected variables, drops all other variables
  - `mutate()`: creates new variables (with new names) and keeps originals
- Each variable transformation is comma-separated  

```r
airbnb |&gt; 
  mutate(
    city = address,
    cost = price,
    description = name
    ) 
```

--

```r
airbnb |&gt; 
  transmute(
    city = address,
    cost = price,
    description = name
    ) 
```

---

# Exercise - 6 minutes

- With `climate`, create a tibble that meets the following conditions:  
  - It contains three variables: `year`, `location`, `temp`
  - Make no changes to `year` 
  - Rename `city` as `location`
  - In `temp`, change `NA` values to `0`  

<div class="countdown" id="timer_74d316b6" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">06</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise - 6 minutes

- With `climate`, create a tibble that meets the following conditions:  
  - It contains three variables: `year`, `location`, `temp`
  - Make no changes to `year` 
  - Rename `city` as `location`
  - In `temp`, change `NA` values to `0`  

```r
climate |&gt; 
  transmute(
    year,
    location = city,
    temp = if_else(is.na(temp), 0, temp)
    ) 
```

---
class: inverse, middle, center

# Filter tibbles

---

# Filter tibbles

- Use `filter()` to subset your data
- With `filter()`, you tell R to exclude/include rows that meet a logical TRUE/FALSE condition
- Operators for conditions are the same as for `if_else()`: `==`, `&lt;`, `&lt;=`, `&gt;`, `&gt;=`, `!=`, `%in%`, `!`, `is.na()`

```r
airbnb |&gt; 
  filter(address != 'Seattle') |&gt; 
  select(room_id, host_id, address)
```

---

# Filter tibbles 
- You can stipulate multiple conditions with `filter()`
  - Use `&amp;` for 'and' expressions
  - Use `|` for 'or' expressions
  - If there are two or more sets of conditions, wrap conditions in `()` or use more than one `filter()`

```r
airbnb |&gt; 
  filter(price &gt; 50 &amp; price &lt; 100 &amp; room_type == 'Entire home/apt') |&gt; 
  select(room_id, host_id, address, room_type, rating, name)
```

---

# Filter tibbles
- Other functions for subsetting your data
  - `head()`
  - `tail()`
  - `sample_n()`
  
--


``` r
airbnb |&gt; sample_n(3) |&gt; select(room_id, host_id, address, room_type, price, name)
## # A tibble: 3 × 6
##    room_id   host_id address room_type       price name                         
##      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;                        
## 1 20601558 147222913 Seattle Entire home/apt   125 Townhouse near DT Seattle w/…
## 2 24497720   5020412 Seattle Private room       50 Flowers, light, &amp; delight (a…
## 3 22037772 160746432 Seattle Entire home/apt   180 Pleasant Private Home on Bea…
```

--


``` r
airbnb |&gt; sample_n(3) |&gt; select(room_id, host_id, address, room_type, price, name)
## # A tibble: 3 × 6
##    room_id  host_id address room_type       price name                          
##      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;                         
## 1 15566068 17045750 Seattle Entire home/apt   295 Lake Union View               
## 2 24119572 50550045 Seattle Entire home/apt    75 Downtown Seattle Studio's 12 …
## 3 22786533  6555745 Seattle Entire home/apt    90 Trendy Travel Accommodations …
```

---

# Exercise - 12 minutes

.pull-left[
- Create a tibble called `colombia` that meets these conditions:  
  - Contains `temp` values not equal to `NA`  
  - Contains data for 'Colombia' only
  - Contains no dates prior to January 2001
  - Contains a variable called `fahrenheit` that converts the `temp` value from celsius to fahrenheit. Use the formula: `(temp * 9/5) + 32` 
  - Contains 4 variables in total in the following order: `year`, `month`, `city`, `fahrenheit`  
  - With extra time, annotate your code (feel free to use ChatGPT)  
]

.pull-right[
- Determine the following: 
  - The number of rows that meet the above filtering conditions  
  - The fahrenheit mean in `colombia`
  - The names of cities in `colombia`
]

<div class="countdown" id="timer_b501b75a" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">12</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise - 12 minutes

- Create a tibble called `colombia` that meets these conditions  
  - Contains `temp` values not equal to `NA`  
  - Contains data for 'Colombia' only
  - Contains no dates prior to January 2001
  - Contains a variable called `fahrenheit` that converts the `temp` value from celsius to fahrenheit. Use the formula: `(temp * 9/5) + 32` 
  - Contains 4 variables in total in the following order: `year`, `month`, `city`, `fahrenheit`  
  - With extra time, annotate your code (feel free to use ChatGPT)  

```r
colombia &lt;- climate |&gt; 
  filter(! is.na(temp) &amp; year &gt; 2000 &amp; country == 'Colombia') |&gt; 
  transmute(
    year,
    month,
    city,
    fahrenheit = (temp * 9/5) + 32
    )
```

---

# Exercise - 12 minutes

- Determine the following: 
  - The number of rows that meet the above filtering conditions  
  - The fahrenheit mean in `colombia`
  - The names of cities in `colombia`


``` r
nrow(colombia)
## [1] 304
mean(colombia$fahrenheit) # colombia |&gt; pull(fahrenheit) |&gt; mean()
## [1] 71.04481
unique(colombia$city) # colombia |&gt; pull(city) |&gt; unique()
## [1] "Bogotá" "Cali"
```

---
class: inverse, middle, center

# Aggregate data with group_by() and summarise()

---

# group_by() and summarise() 

- Count, sum, average, and identify max and min values  
- Powerful in combination with plotting code!  
- Example questions you could answer
  - In `airbnb`, on **average** which city is most costly per night?   
  - In `airbnb`, **how many** listings of each room type are there?
  - In `airbnb`, what's **the total** number of people to stay in each room type?  
  - In `climate`, what's the **average** temperature by year in cities in China?  
  - In `climate`, what's the **smallest** level of uncertainty by year and country?  

---

# group_by() and summarise()  

- In `group_by()`, list the variables by which you want to aggregate data
- In `summarise()`, create a variable and define the variable with an aggregation function
- Use `|&gt;` to 'link' `group_by()` and `summarise()`
- Aggregation functions
  - `n()`, `n_distinct()`, `sum()`, `mean()`, `max()`, `min()`  
- Perform multiple aggregations in a single `summarise()` function  

--

**Example**  
In `airbnb`, on average which city is most costly per night?   

--

```r
airbnb |&gt; 
  group_by(address) |&gt; 
  summarise(mean_cost = mean(price))
```

---

# group_by() and summarise()  

**Example**  
In `airbnb`, how many listings of each room type are there?

--

```r
airbnb |&gt; 
  group_by(room_type) |&gt; 
  summarise(n_listings = n())
```

--

How do you update the code to count the number of room type listings by city?

--

```r
airbnb |&gt; 
  group_by(room_type, address) |&gt; 
  summarise(n_listings = n())
```

--

How do you further update the code to only see rows for Kirkland?

--

```r
airbnb |&gt; 
  group_by(room_type, address) |&gt; 
  summarise(n_listings = n()) |&gt; 
  filter(address == 'Kirkland')
```

---

# group_by() and summarise()  

**Example**  
In `airbnb`, how many listings of each room type are there?

```r
airbnb |&gt; 
  group_by(room_type, address) |&gt; 
  summarise(n_listings = n()) |&gt; 
  filter(address == 'Kirkland')
```

Building on the code above, how would you create a variable that indicates whether there is a deficit of listings for the three `room_types` (let's say "deficit" is defined as fewer than 100 hosts)?

---

# group_by() and summarise()  

**Example**  
In `airbnb`, how many listings of each room type are there?

Building on the code above, how would you create a variable that indicates whether there is a deficit of listings for the three `room_types` (let's say "deficit" is defined as fewer than 100 hosts)?

```r
airbnb |&gt; 
  group_by(room_type, address) |&gt; 
  summarise(n_listings = n()) |&gt; 
  filter(address == 'Kirkland') |&gt; 
  mutate(listings_deficit = ifelse(n_listings &lt; 100, 'y', 'n'))
```

---

# Exercise - 6 minutes

- With the `climate` data, calculate the monthly mean temperature for all cities in China  
- The output should only contain `month` and `mean_temp` variables

```r
climate &lt;- read_csv('https://bit.ly/3kKErEb')
```

<div class="countdown" id="timer_2011ad4a" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">06</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise - 6 minutes

- With the `climate` data, calculate the monthly mean temperature for all cities in China  
- The output should only contain `month` and `mean_temp` variables

```r
climate |&gt; 
  filter(country == 'China') |&gt; 
  group_by(month) |&gt; 
  summarise(mean_temp = mean(temp, na.rm = TRUE))
```

---
class: inverse, middle, center

# Reshaping a tibble or data frame

---

# Reshaping

- `pivot_longer()` and `pivot_wider()` are the functions we use to reshape data
- Reshape means to turn...
  - Columns into rows (with `pivot_longer()`), so the new tibble is narrower, has more rows, and fewer columns than the old tibble
  - Rows into columns (with `pivot_wider()`), so the new tibble is wider and has fewer rows than the old tibble
  
&lt;img src="http://garrettgman.github.io/images/tidy-9.png" style="height: 350px"/&gt;

---

# Reshaping

- `pivot_longer()` and `pivot_wider()` are the functions we use to reshape data
- Reshape means to turn...
  - Columns into rows (with `pivot_longer()`), so the new tibble is narrower, has more rows, and fewer columns than the old tibble
  - Rows into columns (with `pivot_wider()`), so the new tibble is wider and has fewer rows than the old tibble
  
&lt;img src="http://garrettgman.github.io/images/tidy-8.png" style="height: 400px"/&gt;

---

# Reshaping

`pivot_longer()`
- Turn columns into rows
- Often data are **easier to analyze** when stored in columns
- 4 arguments
  - `data`, Your tibble 
  - `cols`, which columns you want turn into rows
  - `names_to`, name of column for column names
  - `values_to`, name of column for values in columns
  
```r
airbnb %&gt;% 
  select(room_id, host_id, room_type, address, reviews, rating) %&gt;% 
  pivot_longer(
    cols = c(reviews, rating)
    , names_to = 'rental_characteristics'
    , values_to = 'values'
    )
  
```

---

# Reshaping

`pivot_wider()`
- Turn rows into columns
  - Good use of screen space
  - Data may be **easier to read** when denormalized (or are in a wider format)
  - Useful format when reporting + useful setting up calculations in specific situations
- 3 arguments
  - `data`, your tibble  
  - `names_from`, name of column that contains the names of the new columns
  - `values_from`, name of columns that contains the values of the new columns

```r
airbnb %&gt;% 
  group_by(address, room_type) %&gt;% 
  summarise(number_of_rentals = n(), .groups = 'drop') %&gt;% 
  pivot_wider(names_from = room_type, values_from = number_of_rentals)
```

--

```r
airbnb %&gt;% 
  group_by(address, room_type) %&gt;% 
  summarise(number_of_rentals = n(), .groups = 'drop') %&gt;% 
  pivot_wider(names_from = room_type, values_from = number_of_rentals) %&gt;%
  mutate(private_or_shared = `Private room` + `Shared room`)
```

---

# Exercise - 10 minutes

With the `climate` data, report the mean temperatures for `"Angola"`, `"Ivory Coast"`, `"Ethiopia"`
, and `"Kenya"` in the years `1850`, `1900`, `1950`, and `2000`
- There should be one row per country
- You should pivot the data so the years are columns like in the example 
- In this exercise you will use `filter()`, `group_by()`, `summarise()`, and `pivot_wider()`

<div class="countdown" id="timer_abee6fde" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise - 10 minutes

**Exercise #1 hint**

```
##       country 1850 1900 1950 2000
## 1      Angola    -    -    -    -
## 2    Ethiopia    -    -    -    -
## 3 Ivory Coast    -    -    -    -
## 4       Kenya    -    -    -    -
```

---

# Exercise - 10 minutes

```r
climate %&gt;% 
  filter(
    country %in% c('Angola', 'Ivory Coast', 'Ethiopia', 'Kenya') 
    &amp; year %in% c(1850, 1900, 1950, 2000)
  ) %&gt;% 
  group_by(country, year) %&gt;% 
  summarise(temp = mean(temp), .groups = 'drop') %&gt;% 
  pivot_wider(names_from = year, values_from = temp, names_sort = TRUE)
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
