<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Part 2 - Introduction to the Tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Graham Bearden" />
    <meta name="date" content="2023-10-10" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/countdown-0.4.0/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.4.0/countdown.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Part 2 - Introduction to the Tidyverse
]
.author[
### Graham Bearden
]
.institute[
### University of Washington
]
.date[
### October 10, 2023
]

---




# Housekeeping

- [...]

---

# What we learned in the previous class

- Getting up and running in RStudio  
- Core R concepts  
  - Data types
  - Relationship between data and functions  
- How to import data  
- Regularly used data summary functions  
- Assignment operator (`&lt;-`)
- A bit about troubleshooting

---

# What we'll learn today  

- More about troubleshooting
- Creating and updating variables  
- Subsetting tibbles/data frames  
- Aggregation  

---

# Troubleshooting your R code

Make sure...

- You loaded your libraries
- Arguments in your functions are comma-separated
- Your functions have start and closing parentheses
- You have start and end quotation marks where relevant
- The variable type is correct to perform the function you call
  - For example you probably don't want to run `min()` on a character string  
- Variables in your environment are spelled correctly  (`ls()`)  
- Your assignment operator looks like this: `&lt;-`
- You're running code inside a code chunk (in a notebook)
- The casing is right (for example, `read_csv()`, not `READ_CSV()`)  

---

# Troubleshooting your R code

- Run code line by line  

--
- Ensure the code isn't hanging (`+`s vs. `&gt;`s in the R console)  

--
- Red "x" annotation beside line numbers (after saving your file)

![](./figures/red_x_example.png)

---

# Troubleshooting exercise 

**Exercise 1 - 5 minutes**  

This code contains 5 mistakes. The code should create four new data objects called `reviews`, `price`, `med_reviews` and `max_price` and report the median number of reviews and highest cost/night for a Seattle Airbnb rental.    

- Correct 5 coding mistakes  
- Reference the previous slides for help  

--

```r
library(tidyverse
        
airbnb &lt; read_csv('https://bit.ly/3oadz2L')

reviews &lt;- airbnb$review
price &lt;- airbnb$price

med_reviews &lt;- median(reviews)
max_price &lt;- MAX(price)

med_reviews
max.price
```

<div class="countdown" id="timer_b617a4e5" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Troubleshooting exercise 

**Exercise 1 - 5 minutes**  

This code contains 5 mistakes. The code should create four new data objects called `reviews`, `price`, `med_reviews` and `max_price` and report the median number of reviews and highest cost/night for a Seattle Airbnb rental.  

![](figures/troubleshoot_solution_1.png)
--

&lt;br&gt;
Is [ChatGPT](https://chat.openai.com/) able to help troubleshoot?

---
class: inverse, middle, center

# Select, create, and rename variables

---

# &lt;span style="color:#6DA34D"&gt;Select&lt;/span&gt;, create, and rename variables 

- `select()` keeps the named variables from the dataset
- You can remove variables from the dataset with `-`
- You may use selection helpers
  - For example, `everything()`
- Use `'``'` for multi-word variables and variable names that begin with numbers

--

```r
select(airbnb, host_id, reviews, rating, price)
```

&lt;table class=" lightable-classic table" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; width: auto !important; float: left; margin-right: 10px;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; host_id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reviews &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rating &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; price &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2536 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4193 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 35749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# &lt;span style="color:#6DA34D"&gt;Select&lt;/span&gt;, create, and rename variables 

- `select()` keeps the named variables from the dataset
- You can remove variables from the dataset with `-`
- You may use selection helpers
  - For example, `everything()`
- Use `'``'` for multi-word variables and variable names that begin with numbers

```r
airbnb_2 &lt;- select(airbnb, host_id, reviews, rating, price)
select(airbnb_2, -rating)
```

&lt;table class=" lightable-classic table" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; width: auto !important; float: left; margin-right: 10px;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; host_id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reviews &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; price &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2536 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4193 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 35749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# &lt;span style="color:#6DA34D"&gt;Select&lt;/span&gt;, create, and rename variables

- `select()` keeps the named variables from the dataset
- You can remove variables from the dataset with `-`
- You may use selection helpers
  - For example, `everything()`
- Use `'``'` for multi-word variables and variable names that begin with numbers

```r
airbnb_2 &lt;- select(airbnb, host_id, reviews, rating, price)
select(airbnb_2, host_id, price, everything())
```

&lt;table class=" lightable-classic table" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; width: auto !important; float: left; margin-right: 10px;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; host_id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; price &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reviews &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rating &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2536 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4193 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 35749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.5 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Make your code as readable as possible

- A whole course could be taught on formatting code
- For our course, use the pipe operator (`%&gt;%`) when working with **tibbles/data frames**  

--

**Bad** 
```r
select(select(airbnb, host_id, reviews, rating, price), host_id, price, everything())
```

**Good** 
```r
airbnb %&gt;%
  select(host_id, reviews, rating, price) %&gt;% 
  select(host_id, price, everything())
```

**Use pipes if possible, but this is okay** 
```r
airbnb_2 &lt;- select(airbnb, host_id, reviews, rating, price)
select(airbnb_2, host_id, price, everything())
```

---

# Make your code as readable as possible

- Use the pipe operator (`%&gt;%`) when working with **tibbles/data frames**  
  - Easier to read and troubleshoot  
  - Easier to comment (write end of line comments or above line comments)
  - Modular
  - Makes data management within your script easier  
  - Style-wise, pipes are the present and future

```r
airbnb %&gt;%
  select(host_id, reviews, rating, price) %&gt;% 
  select(host_id, price, everything()) 
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- `mutate()` creates variables  
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`

--

```r
airbnb %&gt;% 
  mutate(
    cost_per_num_accom = price / accommodates,
    mean_price = mean(price)
    ) 
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

- `mutate()` creates variables
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`

```r
x &lt;- c(1, 2, 3)
y &lt;- c(4, 5, 1)

if_else(x &gt; y, 'yes', 'no')
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- `mutate()` creates variables
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`


```r
x &lt;- c(1, 2, 3)
y &lt;- c(4, 5, 1)

if_else(x &gt; y, 'yes', 'no')
## [1] "no"  "no"  "yes"
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- A little more on `if_else()`  
  - A logical test with a true-or-false outcome
  - To make comparisons use: `==`, `&lt;`, `&lt;=`, `&gt;`, `&gt;=`, `!=`, `%in%`, `!`, `is.na()`
     - `==` 1 to 1 equivalency test
     - `%in%` lets you search for equivalency over a string
  - Concatenate values with `c()`

--


```r
city_1 &lt;- 'San Francisco'
city_2 &lt;- 'Portland'
california &lt;- c('San Francisco', 'Los Angeles', 'San Diego')

if_else(city_1 %in% california, 'yes', 'no')
## [1] "yes"
if_else(city_2 %in% california, 'yes', 'no')
## [1] "no"
if_else(237 %in% 200:300, 'yes', 'no')
## [1] "yes"
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- A little more on `if_else()`  
  - A logical test with a true-or-false outcome
  - To make comparisons use: `==`, `&lt;`, `&lt;=`, `&gt;`, `&gt;=`, `!=`, `%in%`, `!`, `is.na()`
     - `==` 1 to 1 equivalency test
     - `%in%` lets you search for equivalency over a string
  - Concatenate values with `c()`


```r
city_1 &lt;- 'San Francisco'
city_2 &lt;- 'Portland'
california &lt;- c('San Francisco', 'Los Angeles', 'San Diego')

if_else(! city_1 %in% california, 'yes', 'no')
## [1] "no"
if_else(! city_2 %in% california, 'yes', 'no')
## [1] "yes"
if_else(! 237 %in% 200:300, 'yes', 'no')
## [1] "no"
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables

- `mutate()` creates variables
- Create multiple variables at once
- Use functions you already learned within `mutate()`
  - `min()`, `max()`, `mean()`
  - `as.character()`, `as.factor()`, `as.numeric()`
- Use `if_else()` within `mutate()`

```r
airbnb %&gt;% 
  mutate(
    cost_per_num_accom = price / accommodates,
    mean_price = mean(price),
    seattle_address = if_else(address == 'Seattle', 'y', NA),
    large = if_else(accommodates &gt; 5, 'y', NA)
    ) 
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

```r
airbnb %&gt;% 
  mutate(
    cost_per_num_accom = price / accommodates,
    mean_price = mean(price),
    seattle_address = if_else(address == 'Seattle', 'y', NA),
    large = if_else(accommodates &gt; 5, 'y', NA)
    ) %&gt;%
  select(room_id, host_id, cost_per_num_accom, mean_price, seattle_address, large)
```


```
## # A tibble: 5 × 6
##   room_id host_id cost_per_num_accom mean_price seattle_address large
##     &lt;dbl&gt;   &lt;dbl&gt;              &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;
## 1    2318    2536               31.2       112. y               y    
## 2    3335    4193               25         112. y               &lt;NA&gt; 
## 3    4291   35749               41         112. y               &lt;NA&gt; 
## 4    5682    8993               24.5       112. y               &lt;NA&gt; 
## 5    6606   14942               45         112. y               &lt;NA&gt;
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

&lt;b&gt;Exercise - 6 minutes&lt;/b&gt;  
- With the `climate` dataset, create variables called `high_uncertainty` and `winter`
- In `high_uncertainty`, flag with a `1` all observations where `uncertainty` is greater than 1.5. All other rows should have a `0`.  
- In `winter`, flag with a `1` all observations where month is a 1, 2, 12.  
- Only report the following variables in the output: `country`, `city`, `high_uncertainty` and `winter`

--

```r
climate &lt;- read_csv('https://bit.ly/3kKErEb')
```

<div class="countdown" id="timer_ace12ee6" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">06</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

&lt;b&gt;Exercise - 6 minutes&lt;/b&gt;  
- With the `climate` dataset, create variables called `high_uncertainty` and `winter`
- In `high_uncertainty`, flag with a `1` all observations where `uncertainty` is greater than 1.5. All other rows should have a `0`  
- In `winter`, flag with a `1` all observations where month is a 1, 2, 12.  
- Only report the following variables in the output: `country`, `city`, `high_uncertainty` and `winter`

```r
climate %&gt;% 
  mutate(
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    ) %&gt;%
  select(country, city, high_uncertainty, winter)
```

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

```r
climate %&gt;% 
  mutate(
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    ) %&gt;%
  select(country, city, high_uncertainty, winter)
```


```
## # A tibble: 6 × 4
##   country     city    high_uncertainty winter
##   &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;
## 1 Ivory Coast Abidjan                0      1
## 2 Ivory Coast Abidjan                0      1
## 3 Ivory Coast Abidjan                1      0
## 4 Ivory Coast Abidjan                0      0
## 5 Ivory Coast Abidjan                0      0
## 6 Ivory Coast Abidjan                0      0
```

&lt;div class="animate__animated animate__bounce" style="color: #363457; background-color: white"&gt;
  &lt;p id="clickToShow" style="display: none;"&gt;Nice job! Now take a moment to ask ChatGPT to annotate your code.&lt;/p&gt;
  &lt;button id="revealButton"&gt;Do Not Push&lt;/button&gt;
&lt;/div&gt;

&lt;script&gt;
// JavaScript to reveal the hidden text on button click
document.getElementById('revealButton').addEventListener('click', function() {
  document.getElementById('clickToShow').style.display = 'block';
});
&lt;/script&gt;

---

# Select, &lt;span style="color:#6DA34D"&gt;create&lt;/span&gt;, and rename variables 

- `transmute()` = `mutate()` + `select()`

--

```r
climate %&gt;% 
  mutate(
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    ) %&gt;%
  select(country, city, high_uncertainty, winter)
```

--

```r
climate %&gt;% 
  transmute(
    country,
    city,
    high_uncertainty = if_else(uncertainty &gt; 1.5, 1, 0),
    winter = if_else(month %in% c(1, 2, 12), 1, 0)
    )
```

---

# Select, create, and &lt;span style="color:#6DA34D"&gt;rename&lt;/span&gt; variables 

- `rename()` assigns a new name to an existing variable
- Renaming is possible with `transmute()` and `mutate()`as well
  - `rename()`: renames selected variables, keeps all other variables
  - `transmute()`: renames selected variables, drops all other variables
  - `mutate()`: creates new variables (with new names) and keeps originals
- Each variable transformation is comma-separated  

**Example**
- How do I rename `address` as `city`, `price` as `cost`, and `name` as `description` with one of the methods in `airbnb`?

--

```r
airbnb %&gt;% 
  rename(
    city = address,
    cost = price,
    description = name
    ) 
```

---

# Select, create, and &lt;span style="color:#6DA34D"&gt;rename&lt;/span&gt; variables 

- `rename()` assigns a new name to an existing variable
- Renaming is possible with `transmute()` and `mutate()`as well
  - `rename()`: renames selected variables, keeps all other variables
  - `transmute()`: renames selected variables, drops all other variables
  - `mutate()`: creates new variables (with new names) and keeps originals
- Each variable transformation is comma-separated  

```r
airbnb %&gt;% 
  mutate(
    city = address,
    cost = price,
    description = name
    ) 
```

--

```r
airbnb %&gt;% 
  transmute(
    city = address
    cost = price
    description = name
    ) 
```

---

# Exercise - 6 minutes

- With `climate`, create a tibble that meets the following conditions:  
  - It contains three variables: `year`, `location`, `temp`
  - Make no changes to `year` 
  - Rename `city` as `location`
  - In `temp`, change `NA` values to `0`  

<div class="countdown" id="timer_9624b8eb" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">06</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise - 6 minutes

- With `climate`, create a tibble that meets the following conditions:  
  - It contains three variables: `year`, `location`, `temp`
  - Make no changes to `year` 
  - Rename `city` as `location`
  - In `temp`, change `NA` values to `0`  

```r
climate %&gt;% 
  transmute(
    year
    location = city
    temp = if_else(is.na(temp), 0, temp)
    ) 
```

---
class: inverse, middle, center

# Filter tibbles

---

# Filter tibbles

- Use `filter()` to subset your data
- With `filter()`, you tell R to exclude/include rows that meet a logical TRUE/FALSE condition
- Operators for conditions are the same as for `if_else()`: `==`, `&lt;`, `&lt;=`, `&gt;`, `&gt;=`, `!=`, `%in%`, `!`, `is.na()`

```r
airbnb %&gt;% 
  filter(address != 'Seattle') %&gt;% 
  select(room_id, host_id, address)
```

---

# Filter tibbles 
- You can stipulate multiple conditions with `filter()`
  - Use `&amp;` for 'and' expressions
  - Use `|` for 'or' expressions
  - If there are two or more sets of conditions, wrap conditions in `()` or use more than one `filter()`

```r
airbnb %&gt;% 
  filter(price &gt; 50 &amp; price &lt; 100 &amp; room_type == 'Entire home/apt') %&gt;% 
  select(room_id, host_id, address, room_type, rating, name)
```

---

# Filter tibbles
- Other functions for subsetting your data
  - `head()`
  - `tail()`
  - `sample_n()`
  
--


```r
airbnb %&gt;% sample_n(3) %&gt;% select(room_id, host_id, address, room_type, price, name)
## # A tibble: 3 × 6
##    room_id  host_id address room_type       price name                          
##      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;                         
## 1 30015234 55613812 Seattle Entire home/apt   650 Queen Anne Home with Full Sou…
## 2 22532653  3247838 Seattle Entire home/apt   170 University District Craftsman 
## 3 22213318  8534462 Seattle Entire home/apt   100 Unbeatable 100 Walkscore 2BD …
```

--


```r
airbnb %&gt;% sample_n(3) %&gt;% select(room_id, host_id, address, room_type, price, name)
## # A tibble: 3 × 6
##    room_id host_id address room_type       price name                           
##      &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;                          
## 1 22818313  598892 Seattle Entire home/apt    85 Cozy Modern Suite in Walkable …
## 2 18805419 2134209 Seattle Entire home/apt    85 Modern Penthouse with Mountain…
## 3  1121819 6155113 Seattle Entire home/apt   274 Beautiful Spacious Luxury Yacht
```

---

# Exercise - 12 minutes

.pull-left[
- Create a dataset called `colombia` that meets these conditions:  
  - Contains `temp` values not equal to `NA`  
  - Contains data for 'Colombia' only
  - Contains no dates prior to January 2001
  - Contains a variable called `fahrenheit` that converts the `temp` value from celsius to fahrenheit. Use the formula: `(temp * 9/5) + 32` 
  - Contains 4 variables in total in the following order: `year`, `month`, `city`, `fahrenheit`  
  - With extra time, annotate your code (feel free to use ChatGPT)  
]

.pull-right[
- Determine the following: 
  - The number of rows that meet the above filtering conditions  
  - The fahrenheit mean in `colombia`
  - The names of cities in `colombia`
]

<div class="countdown" id="timer_3b61f11f" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">12</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Exercise - 12 minutes

- Create a dataset called `colombia` that meets these conditions  
  - Contains `temp` values not equal to `NA`  
  - Contains data for 'Colombia' only
  - Contains no dates prior to January 2001
  - Contains a variable called `fahrenheit` that converts the `temp` value from celsius to fahrenheit. Use the formula: `(temp * 9/5) + 32` 
  - Contains 4 variables in total in the following order: `year`, `month`, `city`, `fahrenheit`  
  - With extra time, annotate your code (feel free to use ChatGPT)  

```r
colombia &lt;- climate %&gt;% 
  filter(! is.na(temp) &amp; year &gt; 2000 &amp; country == 'Colombia') %&gt;% 
  transmute(
    year,
    month,
    city,
    fahrenheit = (temp * 9/5) + 32
    )
```

---

# Exercise - 12 minutes

- Determine the following: 
  - The number of rows that meet the above filtering conditions  
  - The fahrenheit mean in `colombia`
  - The names of cities in `colombia`


```r
nrow(colombia)
## [1] 304
colombia %&gt;% pull(fahrenheit) %&gt;% mean # OR mean(colombia$fahrenheit)
## [1] 71.04481
colombia %&gt;% pull(city) %&gt;% unique # OR unique(colombia$city)
## [1] "Bogotá" "Cali"
```

---
class: inverse, middle, center

# Dates

---

# Dates

Working with dates can be difficult  
- Date formats vary across datasets
  - POSIXct, POSIXlt, Date, Period, chron, yearmon, yearqtr, zoo, zooreg, timeDate, xts, its, ti, jul, and fts
- Some formats contain metadata
  - timezone, leap year, GMT adjustment
- Some formats are quirky  
  - For example, the month number for January in POSIXlt is 0
- Sometimes dates include times, sometimes not
  - Time can make it challenging to extract date components
- Dates formatted as character strings look right, but often leads to data visualization mistakes and problems in analysis
  - `sort(c('2021-10-02', '2021-1-22', '2021-3-20'))`  
  - `sort(lubridate::ymd(c('2021-10-02', '2021-1-22', '2021-3-20')))`
  
---

# Dates

There are ways to make working with dates easier
  - Use `lubridate` package
    - Dates always formatted as "Date" type
  - Put components of dates in distinct columns if possible  
  - Remove time from date if possible

```r
install.packages('lubridate')
```

--

- Create dates with `lubridate` functions (`ymd()`, `dmy()`, `mdy()`, `ym()`)
  - Apply functions to character values, `'2020-03-15'`  
  - Apply functions to concatenated tibble columns using `paste0()`

--

```r
ymd('2020-03-15')
dmy('15-03-2020')
class(ymd('2020-03-15'))
```

```r
climate %&gt;% 
  mutate(
    date = ym(paste0(year, '-', month))
  )
```

---

# Dates

- Extract components from a date
  - `year()`, `month()`, `day()`
  - May be applied to multiple date formats/classes

---

# Dates

**Exercise - 10 minutes**  

From `climate`, produce a tibble called `turkey` that meets the following requirements:

- Contains data for the country of Turkey only
- Contains data for years 2000 through 2010
- Contains three columns: `city`, `date`, and `temp`
- `date` should be a date variable created from `year` and `month`
- Arrange the dataset by `date` in descending order (`arrange(desc(date))`)

Report the mean monthly temperatures for one city in the dataset (you choose)

<div class="countdown" id="timer_c43a1129" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

```r
turkey &lt;- climate %&gt;% 
  filter(country == 'Turkey' &amp; year %in% 2000:2010) %&gt;% 
  transmute(
    city,
    date = ym(paste0(year, '-', month)),
    temp
  ) %&gt;% 
  arrange(desc(date))
```

--

```r
turkey %&gt;% 
  filter(city == 'Ankara') %&gt;% 
  mutate(m = month(date)) %&gt;% 
  group_by(m) %&gt;% 
  summarise(mean_temp = mean(temp))
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
