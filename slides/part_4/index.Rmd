---
title: "Part 4 - More data visualization and data processing + Agent Mode in VS Code"
author: "Graham Bearden"
institute: "University of Washington"
date: "October 30, 2025"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, metropolis, metropolis-fonts]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{css, echo=FALSE}
.small { font-size: 90% }
.smaller { font-size: 80% }
```

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(countdown)
library(kableExtra)
library(formatR)
library(scales)
library(ggthemes)
options(scipen=999)

opts_chunk$set(warning=FALSE, message=FALSE)

extra_css <- list(
  ".small" = list("font-size" = "90%"),
  ".smaller" = list("font-size" = "80%")
  )

xaringanthemer::style_extra_css(css = extra_css, outfile = "custom.css")

wacky_palette <- c("#FF0099", "#00CCFF", "#FF9900", "#33FF33", "#FF33CC", "#FFFF66", "#6600CC")

airbnb <- read_csv('https://bit.ly/3oadz2L', col_types = cols())
climate <- read_csv('https://bit.ly/3kKErEb', col_types = cols())
checkin <- read_csv('https://bit.ly/3nQHlI0', col_types = cols())
mba <- read_csv("https://bit.ly/4evYpeW", col_types = cols())
```

# Housekeeping

- Reminder: Submit 2 “stakeholder-ready” data visualizations and your code on November 3 or before  
  - The assignment has been added to Canvas
  - See examples [here](https://github.com/gbearden/r_course_evans_school/blob/master/plots/) on Github  
- What does "Stakeholder-ready" mean?  
  - Write a plot title
  - Label the axes 
  - Use a theme
  - Do not include `NA`s in the plot (geom or legend)  
- Datasets  
  - [Kaggle](https://www.kaggle.com/datasets)
  - [Data.gov](https://www.data.gov/)
  - [Washington Post](https://github.com/orgs/washingtonpost/repositories?language=&q=data&sort=&type=)
  - [fivethirtyeight](https://data.fivethirtyeight.com/)  
  - [Awesome Public Datasets on Github](https://github.com/awesomedata/awesome-public-datasets)
  - [BuzzFeed](https://github.com/BuzzFeedNews)  
  - [Google Dataset Search](https://datasetsearch.research.google.com/)
  - BONUS dataset: [Great British Bakeoff](https://github.com/apreshill/bakeoff)  

---

# Housekeeping

- Stay in touch! 
  - Feel free to connect with me on LinkedIn
  - Discussing data science/analytics careers

**Data for class**  
```r
airbnb <- read_csv('https://bit.ly/3oadz2L')
climate <- read_csv('https://bit.ly/3kKErEb')
mba <- read_csv("https://bit.ly/4evYpeW")
```

---

# What we learned in the previous class

- Running code in an R Notebook 
- Overview of ggplot2  
- Building bar plots
  - Aggregated data
  - Disaggregated data
- Customizing plots
  - Adding themes, titles, and scales to plots

---

# What we'll learn today  

- Build line and scatter plots  
- Creating multi-geom (line and bar) plot
- Creating population pyramid
- Pivoting data
- Agent Mode in VS Code

---

# A few reminders

- Run code line by line  
- Ensure the code finished running (`+`s vs. `>`s in the R console)  
- Red "x" annotation beside line numbers (after saving your file)

![](./figures/red_x_example.png)

---

# A few reminders

```r
# Example 1 - use %in% when filtering on a string in the function
climate %>% 
  filter(country %in% c('Brazil', 'China', 'India', 'Turkey', 'United States'))

# Examples 2 & 3 - use %in% or == when filtering on a character string variable
countries <- c('Brazil', 'China', 'India', 'Turkey', 'United States')
climate %>% 
  filter(country %in% countries)

climate %>% 
  filter(country == countries)

# Example 4 - use == to filter on a single value
climate %>% 
  filter(country == "Brazil")

```

---

# A few reminders

```r
# stat = "count"
airbnb %>% 
  ggplot(
    aes(
      x = address,
      fill = address
      )
    ) + 
  geom_bar()
  
# stat = "identity"
airbnb %>% 
  group_by(address) %>% 
  summarise(count = n()) %>%
  ggplot(
    aes(
      x = address,
      y = count,
      fill = address
      )
    ) + 
  geom_bar(stat = 'identity')
```

---

# Warm up Exercise - MBA admissions

Create a stacked bar plot from the UPenn MBA admissions data that shows the number of non-international students by work industry. 

- Stacked bar segments should be mapped to a new variable that indicates whether a GMAT score is high or low. You can decide the threshold for what's "high" and "low"
- Use `reorder()` to sort the bars. Remember that when sorting (or reordering) bars you need to aggregate the data with `group_by()` and `summarise()` before creating the plot  
- Don't forget to use `filter()` to exclude international students 
- Update plot and axis titles and use a theme if you have time

```r
mba <- read_csv("https://bit.ly/4evYpeW")
```

--

```r
mba %>%
  filter() %>% # remove international students from the tibble
  mutate() %>% # create a new variable indicating whether the GMAT score is high/low
  group_by() %>% # group on character variables mapped to an axis and fill
  summarise() %>% # count applications
  ggplot() + 
  geom_bar()
```

```{r, echo = FALSE}
countdown(minutes = 7, seconds = 0)
```

---

# Warm up Exercise - MBA admissions

Create a stacked bar plot from the UPenn MBA admissions data that shows the number of non-international students by work industry. 

```{r, dpi = 300, fig.height = 3, fig.width = 5, echo = FALSE, warning=FALSE, message=FALSE}
mba %>%
  filter(international == FALSE) %>% 
  mutate(high_gmat = if_else(gmat > 650, "High GMAT Score", "Low GMAT Score")) %>% 
  group_by(work_industry, high_gmat) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(y = reorder(work_industry, n), x = n, fill = high_gmat)) +
  geom_bar(stat = "identity") + 
  labs(fill = NULL) + 
  theme_fivethirtyeight() + 
  scale_fill_fivethirtyeight()
```

---

# Warm up Exercise - MBA admissions

Create a stacked bar plot from the UPenn MBA admissions data that shows the number of non-international students by work industry. 

```r
mba %>%
  filter(international == FALSE) %>% 
  mutate(high_gmat = if_else(gmat > 650, "High GMAT Score", "Low GMAT Score")) %>% 
  group_by(work_industry, high_gmat) %>% 
  summarise(n = n())  
```

---

# Warm up Exercise - MBA admissions

Create a stacked bar plot from the UPenn MBA admissions data that shows the number of non-international students by work industry. 

```r
mba %>%
  filter(international == FALSE) %>% 
  mutate(high_gmat = if_else(gmat > 650, "High GMAT Score", "Low GMAT Score")) %>% 
  group_by(work_industry, high_gmat) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(y = reorder(work_industry, n), x = n, fill = high_gmat)) +
  geom_bar(stat = "identity") + 
  labs(fill = NULL) + 
  theme_fivethirtyeight() + 
  scale_fill_fivethirtyeight()
```

--

How do you turn this plot into a population pyramid style plot?

---

# Warm up Exercise - MBA admissions

```{r, fig.show='hide'}

  mba %>%
    filter(international == FALSE) %>% 
    mutate(high_gmat = if_else(gmat > 650, "High GMAT Score", "Low GMAT Score")) %>% 
    group_by(work_industry, high_gmat) %>% 
    summarise(n = n()) %>% 
    mutate(   #<<
      industry_n = sum(n),   #<<
      n = if_else(high_gmat == "Low GMAT Score", n * -1, n)   #<<
      ) %>%    #<<
    ggplot(
      aes(
        y = reorder(work_industry, -industry_n),    #<<
        x = n, 
        fill = high_gmat
        )
      ) +
    geom_bar(stat = "identity") + 
    scale_x_continuous(labels = function(x) abs(x)) +   #<<
    labs(fill = NULL) + 
    theme_fivethirtyeight() + 
    scale_fill_fivethirtyeight()
```

---
class: inverse, middle, center

# Scatterplots and line plots

---

# <img src="figures/line.png" style="height: 70px"/>

.pull-left[
Line plot: 1 continuous variable + ordinal variable   

- Line plots are suited well to dates, but may work well other ordered variables
- `color` and `linetype` are other arguments you can use when building a line plot

```r
climate %>% 
  group_by(year) %>%
  summarise(uncertainty = mean(uncertainty, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = uncertainty)) +
  geom_line()
```
]

.pull-right[
```{r, dpi = 300, fig.height = 3, fig.width = 5, echo = FALSE, warning=FALSE, message=FALSE}
climate %>% 
  group_by(year) %>%
  summarise(uncertainty = mean(uncertainty, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = uncertainty)) +
  geom_line()
```
]

---

# <img src="figures/line.png" style="height: 70px"/>

.pull-left[
Line plot: 1 continuous variable + ordinal variable   

- Line plots are suited well to dates, but may work well other ordered variables
- `color` and `linetype` are other arguments you can use when building a line plot

```r
climate %>% 
  group_by(year) %>%
  summarise(uncertainty = mean(uncertainty, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = uncertainty)) +
  geom_line()
```
]

.pull-right[
How would you make the line red? 

```{r, dpi = 300, fig.height = 3, fig.width = 5, echo = FALSE, warning=FALSE, message=FALSE}
climate %>% 
  group_by(year) %>%
  summarise(uncertainty = mean(uncertainty, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = uncertainty)) +
  geom_line()
```
]

---

# <img src="figures/scatter.png" style="height: 70px"/>


.pull-left[
Scatterplots: 2 continuous variables 

- When there are a lot of overlapping data, `alpha` is useful
- `color`, `shape`, `size` are other arguments you can use when building a scatter plot

```r
climate %>% 
  ggplot(
    aes(
      x = temp
      , y = uncertainty
      )
    ) + 
  geom_point(alpha = .1)
```
]

.pull-right[
```{r, dpi = 300, fig.height = 3, fig.width = 5, echo = FALSE, warning=FALSE, message=FALSE}
climate %>% 
  ggplot(
    aes(
      x = temp
      , y = uncertainty
      )
    ) + 
  geom_point(alpha = .1)
```
]

---

# <img src="figures/scatter.png" style="height: 70px"/>


.pull-left[
Scatterplots: 2 continuous variables 

- When there are a lot of overlapping data, `alpha` is useful
- `color`, `shape`, `size` are other arguments you can use when building a scatter plot

```r
climate %>% 
  ggplot(
    aes(
      x = temp
      , y = uncertainty
      )
    ) + 
  geom_point(alpha = .1)
```
]

.pull-right[
Take a moment to create scatterplots with (a) `gpa` and `gmat` from `mba` and (b) `year` and `uncertainty` from `climate`
]

---

# Exercise

- With `airbnb`, create a scatterplot that plots two numeric variables  
- In addition to `x` and `y`, include another argument in `aes()`
   - For example, `size`, `shape`, `color` or `alpha`  
- Use `group_by()` and `summarise()` if you would like  
- Feel free to subset your data with `filter` or `sample_n()`

```{r, echo = FALSE}
countdown(minutes = 7, seconds = 0, left = 0)
```

---

# Exercise

```{r, dpi = 300, fig.height = 4, fig.width = 7, echo = FALSE, warning=FALSE, message=FALSE}
airbnb %>% 
  ggplot(aes(x = longitude, y = latitude, color = address)) + 
  geom_point(alpha = .6) + 
  theme_bw() + 
  labs(
    x = 'Longitude'
    , y = 'Latitude'
    , color = 'City'
    , title = 'Coordinates of Seattle-area Airbnbs'
  )
```

---

# Exercise

```r
airbnb %>% 
  ggplot(aes(x = longitude, y = latitude, color = address)) + 
  geom_point(alpha = .6) + 
  theme_bw() + 
  labs(
    x = 'Longitude'
    , y = 'Latitude'
    , color = 'City'
    , title = 'Coordinates of Seattle-area Airbnbs'
  )
```

---

# Exercise

- With `climate`, create a line plot of mean Fahrenheit temperatures for cities in Brazil
  - Data should be for 1850 and onward ([help](https://gbearden.github.io/r_course_evans_school/slides/part_2/#44))  
  - Use the following formula to convert Celsius to Fahrenheit: `(temp * 9/5) + 32` ([help](https://gbearden.github.io/r_course_evans_school/slides/part_2/#28))  
  - Create the mean temperature with `summarise` and call it `mean_temp` ([help](https://gbearden.github.io/r_course_evans_school/slides/part_3/#33))  
  - Make line color equal to `city`
  - Feel free to change plot aesthetics as you see fit (add a theme; change axis, legend, or plot titles; change the color of lines for cities; etc.)  
  - *Click forward once for a hint on the functions required to prepare the data*  
  - *Click forward twice to see the plot you'll create*

```{r, echo = FALSE}
countdown(minutes = 15, seconds = 0, left = 0)
```

--

```r
climate %>% 
  filter() %>% 
  mutate() %>% 
  group_by() %>% 
  summarise()
```

---

# Exercise

```{r, dpi = 300, fig.height = 4, fig.width = 6, echo = FALSE, warning=FALSE, message=FALSE}
climate %>% 
  filter(country == 'Brazil' & year >= 1850) %>% 
  mutate(temp = (temp * 9/5) + 32) %>% 
  group_by(year, city) %>% 
  summarise(mean_temp = mean(temp, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_temp, color = city)) + 
  geom_line(size = 1) + 
  theme_bw() + 
  scale_color_wsj() + 
  labs(
    x = 'Year'
    , y = 'Mean Temperature'
    , title = 'Temperatures in 6 Brazilian Cities, 1850 - present'
    , color = NULL
  )
```

---

# Exercise

```r
climate %>% 
  filter(country == 'Brazil' & year >= 1850) %>% 
  mutate(temp = (temp * 9/5) + 32) %>% 
  group_by(year, city) %>% 
  summarise(mean_temp = mean(temp, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_temp, color = city)) + 
  geom_line(size = 1) + 
  theme_bw() + 
  scale_color_wsj() + 
  labs(
    x = 'Year'
    , y = 'Mean Temperature'
    , title = 'Temperatures in 6 Brazilian Cities, 1850 - present'
    , color = NULL
  )
```

--

How do you add a bar showing the mean temperature for Brazil?

---

class: small

# Exercise 

```{r, fig.show='hide'}

brazil_cities <- climate %>% 
  filter(country == 'Brazil' & year >= 1850) %>% 
  mutate(temp = (temp * 9/5) + 32) %>% 
  group_by(year, city) %>% 
  summarise(mean_temp = mean(temp, na.rm = TRUE)) 

brazil_temp <-    #<<
  brazil_cities %>%    #<<
  summarise(brazil_temp = mean(mean_temp, na.rm = TRUE))    #<<

brazil_cities %>% 
  ggplot(aes(x = year)) + 
  geom_bar(   #<<
    data = brazil_temp,    #<<
    stat = 'identity',    #<<
    aes(y = brazil_temp),    #<<
    alpha = .4,    #<<
    fill = "#76c893"   #<<
    ) +   #<<
  geom_line(size = 1, aes(y = mean_temp, color = city)) + 
  coord_cartesian(ylim = c(65, NA)) +   #<<
  theme_bw() + 
  scale_color_wsj() + 
  labs(
    x = 'Year'
    , y = 'Mean Temperature'
    , title = 'Temperatures in 6 Brazilian Cities, 1850 - present'
    , color = NULL
  )

```

---

# Setting up VS Code and Github

- Click [here](https://gbearden.github.io/r_course_evans_school/help/vscode/) to set up VS Code and Github
- Open a text file, click on "select a language," and select R
- Connect VS Code and Github

---

# AI Tools in VS Code

- Auto-complete code in an R script
- Inline and side chat
  - Chat modes
  - Models

---
  
# VS Code Agent Mode

Use Agent Mode to:  

- Explore files + ask structured questions
- Request code generation + edits
- Run code or workflows 

**Tips**

- Be specific when asking agents to edit files
- Validate results—agents can be wrong
- Break requests into small steps
- Give permission to perform tasks

**Datasets**

- airbnb. https://bit.ly/3oadz2L
- climate. https://bit.ly/3kKErEb
- mba. https://bit.ly/4evYpeW

---

# VS Code Agent Mode

**Datasets**

- airbnb. https://bit.ly/3oadz2L
- climate. https://bit.ly/3kKErEb
- mba. https://bit.ly/4evYpeW

What analyses would you like for the agent to conduct? Find the best value Airbnb properties? Identify the city with the most stable climate? 

--

**My prompt**

<i>I need to conduct an analysis in R in which I evaluate the data in the climate dataset you can find here: https://bit.ly/3kKErEb. Write the R code in the tidyverse. Perform the following tasks:

- Identify countries where temperature change over time is minimal
- Identify countries where temperature change over time is significant
- Determine whether there is an pattern to the uncertainty in the dataset
- Create data visualizations

Please package the anaysis so that it's ready to share with stakeholder groups.</i>

---

# VS Code Agent Mode

**Additional Prompts**

Prompt #2  
<i>This code has errors. Are you able to iteratively work through it and identify and fix the errors?</i>  

Prompt #3  
<i>When creating country_trends, it throws the error:  
<br>
Error in group_by():  
! Must group by variables found in .data.  
✖ Column Country is not found.</i>  

Prompt #4  
<i>Really nice job, thank you. Please add code to the script to recommend a few countries where I should consider moving given that I prefer warm temperatures and climate stability.</i>  

Prompt #5  
<i>You put the code at the top of the script. Could you append it to the bottom?</i>
